<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Self Nas Environment Project - Wenhan Shi Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Wenhan Shi"><meta name=description content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them. Overview Use Samba to share storage, and use PhotoSync to upload photoes from"><meta name=keywords content="Ubuntu,RHEL,Docker,Kubernetes,OpenShift,GlusterFS"><meta name=generator content="Hugo 0.62.2 with theme even"><link rel=canonical href=https://wenhan.blog/post/self-nas-environment-project/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><link href=/dist/even.c2a46f00.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Self Nas Environment Project"><meta property="og:description" content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them. Overview Use Samba to share storage, and use PhotoSync to upload photoes from"><meta property="og:type" content="article"><meta property="og:url" content="https://wenhan.blog/post/self-nas-environment-project/"><meta property="article:published_time" content="2020-04-05T15:22:58+09:00"><meta property="article:modified_time" content="2022-03-04T13:06:44+09:00"><meta itemprop=name content="Self Nas Environment Project"><meta itemprop=description content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them. Overview Use Samba to share storage, and use PhotoSync to upload photoes from"><meta itemprop=datePublished content="2020-04-05T15:22:58+09:00"><meta itemprop=dateModified content="2022-03-04T13:06:44+09:00"><meta itemprop=wordCount content="2538"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Self Nas Environment Project"><meta name=twitter:description content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them. Overview Use Samba to share storage, and use PhotoSync to upload photoes from"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>WenhanBlog</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>WenhanBlog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav><div class=social-links><a href=mailto:shibunkan@gmail.com class="iconfont icon-email" title=email></a><a href=https://twitter.com/shi_wenhan class="iconfont icon-twitter" title=twitter></a><a href=https://www.linkedin.com/in/wenhan-shi-0883a9132/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/xibuka class="iconfont icon-github" title=github></a><a href=https://www.zhihu.com/people/xibuka class="iconfont icon-zhihu" title=zhihu></a><a href=https://wenhan.blog/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Self Nas Environment Project</h1><div class=post-meta><span class=post-time>2020-04-05</span>
<span class=more-meta>2538 words</span>
<span class=more-meta>6 mins read</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#confirm-smart-status>Confirm SMART status</a></li><li><a href=#show-smart-infomation>Show SMART infomation</a></li><li><a href=#available-tests-for-the-diskscsi>Available Tests for the disk(SCSI)</a><ul><li><a href=#short-test>Short Test</a></li><li><a href=#long-test>Long Test</a></li></ul></li><li><a href=#perform-a-test>Perform a test</a></li><li><a href=#verify-the-test-result>Verify the test result</a></li><li><a href=#force-stop-the-test>Force stop the test</a></li><li><a href=#refer>refer</a></li></ul></nav></div></div><div class=post-content><p>This artcle is a note for myself to build a private NAS station using Ubuntu
20.04. The main usage of my NAS is to store photoes.
For other services, run webmin to control machine via WebUI, and run Emby/
Jellyfin for multi media. Above 2 will run in docker so I also run portainer
to manage them.</p><h1 id=overview>Overview</h1><p>Use Samba to share storage, and use <code>PhotoSync</code> to upload photoes from iPhone
to NAS. Use smartctl to check the disk condition, if anything need attention
send a mail to me.</p><h1 id=file-share-samba>File share (Samba)</h1><p>Install Samba by the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>sudo apt-get install samba smbfs
</code></pre></td></tr></table></div></div><p>Configure samba settings by opening <code>/etc/samba/smb.conf</code>,
If needed, change your workgroup</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = WORKGROUP
</code></pre></td></tr></table></div></div><p>Next is to set your share folder, input something like this at the end of the
file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>[share]
   comment = Share directory for my self-nas
   path = /share
   read only = no
   guest only = no
   guest ok = no
   share modes = yes
</code></pre></td></tr></table></div></div><p>Restart <code>smbd</code> service and confirm the service is running.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>wshi@nuc:~$ sudo systemctl restart smbd
wshi@nuc:~$ sudo systemctl status smbd
● smbd.service - Samba SMB Daemon
   Loaded: loaded (/lib/systemd/system/smbd.service; enabled; vendor preset: enabled)
   Active: active (running) since Fri 2020-04-10 15:58:55 JST; 3s ago
     Docs: man:smbd(8)
           man:samba(7)
           man:smb.conf(5)
 Main PID: 7696 (smbd)
   Status: &#34;smbd: ready to serve connections...&#34;
    Tasks: 4 (limit: 4915)
   CGroup: /system.slice/smbd.service
           ├─7696 /usr/sbin/smbd --foreground --no-process-group
           ├─7712 /usr/sbin/smbd --foreground --no-process-group
           ├─7713 /usr/sbin/smbd --foreground --no-process-group
           └─7722 /usr/sbin/smbd --foreground --no-process-group

Apr 10 15:58:55 nuc systemd[1]: Starting Samba SMB Daemon...
Apr 10 15:58:55 nuc systemd[1]: Started Samba SMB Daemon.
</code></pre></td></tr></table></div></div><p>Set the password of the user which you want to use to access the samba server.
You can use this command again if you forgot the password.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>wshi@nuc:~$ sudo smbpasswd -a wshi
</code></pre></td></tr></table></div></div><p>Finially, create the share folder and set the right permissions <code>0777</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo mkdir /share
$ sudo chmod 0777 /share
</code></pre></td></tr></table></div></div><h1 id=disk-check---smart>Disk Check - SMART</h1><p>The NAS system will be 24x7 running so we need some script to monitor its
health. SMART is a good tool for monitoring HDD,SSD and eMMC drives.</p><h2 id=installation>Installation</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo apt-get install smartmontools
</code></pre></td></tr></table></div></div><h2 id=confirm-smart-status>Confirm SMART status</h2><p>Scan hard disk,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl --scan     
/dev/sda -d scsi # /dev/sda, SCSI device
/dev/sdb -d sat # /dev/sdb [SAT], ATA device
/dev/nvme0 -d nvme # /dev/nvme0, NVMe device
</code></pre></td></tr></table></div></div><p>Ensure the hard disk support SMART and is enable</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -i /dev/sda  
smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org

=== START OF INFORMATION SECTION ===
Model Family:     Western Digital Green
Device Model:     WDC WD20EARX-00PASB0
Serial Number:    WD-WCAZAE607205
LU WWN Device Id: 5 0014ee 20713dc7e
Firmware Version: 51.0AB51
User Capacity:    2,000,398,934,016 bytes [2.00 TB]
Sector Sizes:     512 bytes logical, 4096 bytes physical
Device is:        In smartctl database [for details use: -P show]
ATA Version is:   ATA8-ACS (minor revision not indicated)
SATA Version is:  SATA 3.0, 6.0 Gb/s (current: 6.0 Gb/s)
Local Time is:    Tue Apr 21 10:58:05 2020 JST
SMART support is: Available - device has SMART capability.
SMART support is: Enabled
</code></pre></td></tr></table></div></div><p>The last 2 lines show whether SMART support is available and enabled.</p><h2 id=show-smart-infomation>Show SMART infomation</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -A /dev/sda
smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org

=== START OF READ SMART DATA SECTION ===
SMART Attributes Data Structure revision number: 16
Vendor Specific SMART Attributes with Thresholds:
ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE
  1 Raw_Read_Error_Rate     0x002f   200   200   051    Pre-fail  Always       -       1
  3 Spin_Up_Time            0x0027   165   157   021    Pre-fail  Always       -       6716
  4 Start_Stop_Count        0x0032   100   100   000    Old_age   Always       -       665
  5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0
  7 Seek_Error_Rate         0x002e   200   200   000    Old_age   Always       -       0
  9 Power_On_Hours          0x0032   098   098   000    Old_age   Always       -       1946
 10 Spin_Retry_Count        0x0032   100   100   000    Old_age   Always       -       0
 11 Calibration_Retry_Count 0x0032   100   100   000    Old_age   Always       -       0
 12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       616
192 Power-Off_Retract_Count 0x0032   200   200   000    Old_age   Always       -       39
193 Load_Cycle_Count        0x0032   196   196   000    Old_age   Always       -       13842
194 Temperature_Celsius     0x0022   127   099   000    Old_age   Always       -       23
196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0
197 Current_Pending_Sector  0x0032   200   200   000    Old_age   Always       -       0
198 Offline_Uncorrectable   0x0030   200   200   000    Old_age   Offline      -       0
199 UDMA_CRC_Error_Count    0x0032   200   200   000    Old_age   Always       -       0
200 Multi_Zone_Error_Rate   0x0008   200   200   000    Old_age   Offline      -       0
</code></pre></td></tr></table></div></div><h2 id=available-tests-for-the-diskscsi>Available Tests for the disk(SCSI)</h2><p>There are 2 types of tests:</p><h3 id=short-test>Short Test</h3><p>This test is the rapid identification of a defective hard drive.
There fore, a maximum run time is 2 min. This test checks the disk by
dividing it into 3 different segments. The following areas are tested.</p><ul><li>Electrical Properties: The controller tests its own electronics, and since this is specific to each manufacturer, it cannot be explained exactly what is being tested. It is conceivable, for example, to test the internal RAM, the read/write circuits or the head electronics.</li><li>Mechanical Properties: The exact sequence of the servos and the positioning mechanism to be tested is also specific to each manufacturer.</li><li>Read/Verify: It will read a certain area of the disk and verify certain data, the size and position of the region that is read is also specific to each manufacturer.</li></ul><h3 id=long-test>Long Test</h3><p>This test is designed as the final test in production. There is no time restriction and the entire disk is checked and not just a section.</p><p>There are also other test which only available for ATA hard drive.
Conveyance Test and Select Test.</p><h2 id=perform-a-test>Perform a test</h2><p>Before performing a test, you can use following command to show the time
duration of the various tests</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -c /dev/sdc
</code></pre></td></tr></table></div></div><p>Example output</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>...
Short self-test routine 
recommended polling time:        (   2) minutes.
Extended self-test routine
recommended polling time:        ( 353) minutes.
Conveyance self-test routine
recommended polling time:        (   5) minutes.
...
</code></pre></td></tr></table></div></div><p>The following command starts the desired test (in Background Mode)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -t &lt;short|long|conveyance|select&gt; /dev/sda
</code></pre></td></tr></table></div></div><p>For example,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -t short /dev/sda
smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org

=== START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION ===
Sending command: &#34;Execute SMART Short self-test routine immediately in off-line mode&#34;.
Drive command &#34;Execute SMART Short self-test routine immediately in off-line mode&#34; successful.
Testing has begun.
Please wait 2 minutes for test to complete.
Test will complete after Tue Apr 21 11:25:01 2020 JST
Use smartctl -X to abort test.
</code></pre></td></tr></table></div></div><p>The test will run in background and the priority of the test is low, which means
the normal instructions continue to be processed by the hard disk. If the hard
drive is busy, the test is paused and then continues at a lower load speed, so
there is no interruption of the operation.</p><p>There is another <code>Foreground</code> mode which all commands will be answered during
the test with a &ldquo;CHECK CONDITION&rdquo; status. Therefore, this mode is only
recommended when the hard disk is not used. In principle, the background mode
is the preferred mode.</p><p>To perform the tests in Foreground Mode a <code>-C</code> must be added to the command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -t short -C /dev/sda
</code></pre></td></tr></table></div></div><h2 id=verify-the-test-result>Verify the test result</h2><p>The test results are included in the output of the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -a /dev/sda
</code></pre></td></tr></table></div></div><p>Example output</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>...
SMART Self-test log structure revision number 1
Num  Test_Description    Status                  Remaining  LifeTime(hours)  LBA_of_first_error
# 1  Short offline       Completed without error       00%      1946         -
...
</code></pre></td></tr></table></div></div><p>Or use the following, if only the test results should are displayed:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -l selftest /dev/sda
smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org

=== START OF READ SMART DATA SECTION ===
SMART Self-test log structure revision number 1
Num  Test_Description    Status                  Remaining  LifeTime(hours)  LBA_of_first_error
# 1  Short offline       Completed without error       00%      1946         -
</code></pre></td></tr></table></div></div><h2 id=force-stop-the-test>Force stop the test</h2><p>Use <code>-X</code> if you want to stop the test when performing.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo smartctl -X /dev/sda
smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org

=== START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION ===
Sending command: &#34;Abort SMART off-line mode self-test routine&#34;.
Self-testing aborted!
</code></pre></td></tr></table></div></div><p>We can use this tool to check the disk status and send us email if anything
need our attention.</p><h2 id=refer>refer</h2><p>[https://mekou.com/linux-magazine/smartctl-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E6%B4%BB%E5%8B%95%E3%81%AE%E8%A9%B3%E7%B4%B0%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%8E%E9%9B%86/](smartctl コマンドでディスク活動の詳細情報を収集)</p><p>[https://www.thomas-krenn.com/en/wiki/SMART_tests_with_smartctl#ATA.2FSCSI_Tests](SMART tests with smartctl)</p><h1 id=mail---sendemailcli>Mail - sendEmail(CLI)</h1><p>The NAS system will be 24x7 running so we need some script to monitor its
health. If anything is not good it's necessary to inform me by sending a mail.
SendEmail is a lightweight, completely command line-based SMTP email delivery
program. If you have the need to send email from a command prompt this tool is
perfect.</p><p>Install SendEmail by following command</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo apt install sendemail
</code></pre></td></tr></table></div></div><p>OK, let's send a test mail by it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sendEmail -f &lt;FROM ADDRESS&gt;@gmail.com \
            -s smtp.gmail.com:587 \
            -xu &lt;USERNAME&gt; \
            -xp &lt;PASSWORD&gt; \
            -t &lt;TO ADDRESS&gt;@gmail.com  \
            -u &#34;test title&#34; \
            -m &#34;test contents&#34;
Apr 06 14:33:24 nuc sendEmail[24438]: NOTICE =&gt; Authentication not supported by the remote SMTP server!
Apr 06 14:33:25 nuc sendEmail[24438]: ERROR =&gt; Received: 	530 5.7.0 Must issue a STARTTLS command first. mm18sm11195078pjb.39 - gsmtp
</code></pre></td></tr></table></div></div><p>Oops, it failed with unsupported error. And looks related to tls.</p><p>Let's specify the tls supported and re-run the command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sendEmail -f &lt;FROM ADDRESS&gt;@gmail.com \
            -s smtp.gmail.com:587 \
            -xu &lt;USERNAME&gt; \
            -xp &lt;PASSWORD&gt; \
            -t &lt;TO ADDRESS&gt;@gmail.com  \
            -u &#34;test title&#34; \ 
            -m &#34;test contents&#34; \
            -o tls=yes
Apr 06 15:16:10 nuc sendEmail[25354]: ERROR =&gt; No TLS support!  SendEmail can&#39;t load required libraries. (try installing Net::SSLeay and IO::Socket::SSL)
</code></pre></td></tr></table></div></div><p>We got a different message, and the root cause is we need more libraries. There
are 2 packages we need to install.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo apt-get install libnet-ssleay-perl
$ sudo apt-get install libio-socket-ssl-perl
</code></pre></td></tr></table></div></div><p>Re-run the command and we can send email from CLI. :-)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>Apr 06 15:17:28 nuc sendEmail[25507]: Email was sent successfully!
</code></pre></td></tr></table></div></div><h1 id=docker-management---portainer>docker management - portainer</h1><p>There are a lot of docker image for a better NAS life, so let's install and
setup Portainer first.
Portainer gives you a detailed overview of your Docker environments and allows
you to manage your containers, images, networks and volumes.
Install protainer is easy as it can be deployed as a container. Use the
following command to deploy the Portainer Server.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ docker volume create portainer_data
$ docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
</code></pre></td></tr></table></div></div><p>Please note the <code>-v /var/run/docker.sock:/var/run/docker.sock</code> works in Linux
environment only.</p><p>If your container runs successfully, You can now login to <code>https://&lt;SERVER IP ADDR>:9000/</code> to access the protainer dashboard. First it will ask you a new
password for admin user. Connect your local docker engine environment and you
can see something as follows.</p><p><img src=/img/2020-04-06_11-38.png alt=protainer_dashboard></p><h1 id=multi-media----emby-server>multi-media - Emby server</h1><p>Emby is a media server designed to organize, play, and stream audio and video
to a variety of devices.</p><p>The install is very easy, you can start a container to run Emby server. There
is a Installation Guide on <img src=https://hub.docker.com/r/emby/embyserver#installation alt=dockerhub></p><p>First pull the latest image</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>docker pull emby/embyserver:latest
</code></pre></td></tr></table></div></div><p>Then just launch a new container using the following command</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>docker run -d \
    --volume /path/to/programdata:/config \ # This is mandatory
    --volume /path/to/share1:/mnt/share1 \ # To mount a first share
    --volume /path/to/share2:/mnt/share2 \ # To mount a second share
    --device /dev/dri:/dev/dri \ # To mount all render nodes for VAAPI/NVDEC/NVENC
    --runtime=nvidia \ # To expose your NVIDIA GPU
    --publish 8096:8096 \ # To expose the HTTP port
    --publish 8920:8920 \ # To expose the HTTPS port
    --env UID=1000 \ # The UID to run emby as (default: 2)
    --env GID=100 \ # The GID to run emby as (default 2)
    --env GIDLIST=100 \ # A comma-separated list of additional GIDs to run emby as (default: 2)
    emby/embyserver:latest
</code></pre></td></tr></table></div></div><p>Above one is from the offical guide, but you don't need to set all the options.
Some of the options are not necessary to change, if you ignore it the default
setting will work. Let me paste the command works for me.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo docker run -d  --volume /share/movie:/mnt/share1 \
                      --publish 8096:8096  \
                      --env UID=`id -u` \
                      --env GID=`id -g` \
                      emby/embyserver:latest
</code></pre></td></tr></table></div></div><p>If your container runs successfully, You can now login to <code>https://&lt;SERVER IP ADDR>:8096/</code> to access the Emby site, and follow the guide to set your
environment.</p><p>There is one important setting about the subtitles, you need to create a new
account at <a href=https://www.opensubtitles.org/,>https://www.opensubtitles.org/,</a> and set your username/password in
Emby. Then you should download subtitle in Emby, this is super helpful.</p><h1 id=web-control-pannel---webmin>Web control pannel - webmin</h1><p>Webmin is a web-based interface for system administration for Unix. Using any
modern web browser, you can setup user accounts, Apache, DNS, file sharing and
much more. Webmin removes the need to manually edit Unix configuration files
like /etc/passwd, and lets you manage a system from the console or remotely.
See the standard modules page for a list of all the functions built into
Webmin.</p><p>The install of webmin is easy. First need to import the webmin GPG key and the
apt-repository. Then you can just install webmin via <code>apt</code> command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ wget -q http://www.webmin.com/jcameron-key.asc -O- | sudo apt-key add -
$ sudo add-apt-repository &#34;deb [arch=amd64] http://download.webmin.com/download/repository sarge contrib&#34;
$ sudo apt install webmin
</code></pre></td></tr></table></div></div><p>After the install, a message will be displayed as follows. Access the URL with
the username and password in the host machine to login to the webUI.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>Webmin install complete. You can now login to https://&lt;SERVER IP ADDR&gt;:10000/
as root with your root password, or as any user who can use sudo
to run commands as root.
</code></pre></td></tr></table></div></div><p>The dashboard is like this
<img src=/img/2020-04-05_16-29.png alt=dashboard></p><p>Then you can check or modify contents/settings on the host machine.
For example, to check the files, click <code>Others->FIle Manager</code>.</p><p><img src=/img/2020-04-05_16-35.png alt=filemanager></p><p>If your system is behind a UFW firewall, you may need to open the 10000 port
which is used by default to listen connections.</p><p>To alow traffic on port <code>10000</code> run the following command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ sudo ufw allow 10000/tcp
</code></pre></td></tr></table></div></div><p>Refers to</p><p><a href=https://www.digitalocean.com/community/tutorials/how-to-install-webmin-on-ubuntu-18-04>https://www.digitalocean.com/community/tutorials/how-to-install-webmin-on-ubuntu-18-04</a></p><p><a href=https://linuxize.com/post/how-to-install-webmin-on-ubuntu-18-04/>https://linuxize.com/post/how-to-install-webmin-on-ubuntu-18-04/</a></p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Wenhan Shi</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2022-03-04
<a href=https://github.com/xibuka/xibuka.github.io.git/commit/e2075170d52a93b67757d63685bc50ec4a77e340 title="Merge branch 'master' of https://github.com/xibuka/blogsrc commit it!">(e207517)</a></span></p></div><footer class=post-footer><nav class=post-nav><a class=prev href=/post/install-linux-os-with-qemu-cli/><i class="iconfont icon-left"></i><span class="prev-text nav-default">Install Linux OS With Qemu CLI</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/multipass-launch-failed-by-network-timeout/><span class="next-text nav-default">Multipass Launch Failed by Network Timeout</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=xibuka/xibuka.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:shibunkan@gmail.com class="iconfont icon-email" title=email></a><a href=https://twitter.com/shi_wenhan class="iconfont icon-twitter" title=twitter></a><a href=https://www.linkedin.com/in/wenhan-shi-0883a9132/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/xibuka class="iconfont icon-github" title=github></a><a href=https://www.zhihu.com/people/xibuka class="iconfont icon-zhihu" title=zhihu></a><a href=https://wenhan.blog/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span></span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2016 -
2022
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Wenhan Shi</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/dist/even.26188efa.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-87273435-2','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>