<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Self Nas Environment Project | Wenhan blog</title><meta name=keywords content>
<meta name=description content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them.
Overview Use Samba to share storage, and use PhotoSync to upload photoes from iPhone to NAS.">
<meta name=author content="Me">
<link rel=canonical href=https://wenhan.blog/post/self-nas-environment-project/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href="https://media.licdn.com/dms/image/C4D03AQHsFHxbDCgPsA/profile-displayphoto-shrink_400_400/0/1517015003915?e=1683763200&v=beta&t=PR0k2MbOHcJjtozRAQipgSz2CGprYxywDGgXInkOXmo">
<link rel=icon type=image/png sizes=16x16 href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-87273435-2","auto"),ga("send","pageview"))</script><meta property="og:title" content="Self Nas Environment Project">
<meta property="og:description" content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them.
Overview Use Samba to share storage, and use PhotoSync to upload photoes from iPhone to NAS.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://wenhan.blog/post/self-nas-environment-project/"><meta property="og:image" content="https://wenhan.blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-04-05T15:22:58+09:00">
<meta property="article:modified_time" content="2020-04-05T15:22:58+09:00"><meta property="og:site_name" content="Wenhan blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://wenhan.blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Self Nas Environment Project">
<meta name=twitter:description content="This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them.
Overview Use Samba to share storage, and use PhotoSync to upload photoes from iPhone to NAS.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wenhan.blog/post/"},{"@type":"ListItem","position":2,"name":"Self Nas Environment Project","item":"https://wenhan.blog/post/self-nas-environment-project/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Self Nas Environment Project","name":"Self Nas Environment Project","description":"This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them.\nOverview Use Samba to share storage, and use PhotoSync to upload photoes from iPhone to NAS.","keywords":[],"articleBody":"This artcle is a note for myself to build a private NAS station using Ubuntu 20.04. The main usage of my NAS is to store photoes. For other services, run webmin to control machine via WebUI, and run Emby/ Jellyfin for multi media. Above 2 will run in docker so I also run portainer to manage them.\nOverview Use Samba to share storage, and use PhotoSync to upload photoes from iPhone to NAS. Use smartctl to check the disk condition, if anything need attention send a mail to me.\nFile share (Samba) Install Samba by the following:\n1  sudo apt-get install samba smbfs   Configure samba settings by opening /etc/samba/smb.conf, If needed, change your workgroup\n1 2  # Change this to the workgroup/NT-domain name your Samba server will part of workgroup = WORKGROUP   Next is to set your share folder, input something like this at the end of the file.\n1 2 3 4 5 6 7  [share] comment = Share directory for my self-nas path = /share read only = no guest only = no guest ok = no share modes = yes   Restart smbd service and confirm the service is running.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  wshi@nuc:~$ sudo systemctl restart smbd wshi@nuc:~$ sudo systemctl status smbd ● smbd.service - Samba SMB Daemon Loaded: loaded (/lib/systemd/system/smbd.service; enabled; vendor preset: enabled) Active: active (running) since Fri 2020-04-10 15:58:55 JST; 3s ago Docs: man:smbd(8) man:samba(7) man:smb.conf(5) Main PID: 7696 (smbd) Status: \"smbd: ready to serve connections...\" Tasks: 4 (limit: 4915) CGroup: /system.slice/smbd.service ├─7696 /usr/sbin/smbd --foreground --no-process-group ├─7712 /usr/sbin/smbd --foreground --no-process-group ├─7713 /usr/sbin/smbd --foreground --no-process-group └─7722 /usr/sbin/smbd --foreground --no-process-group Apr 10 15:58:55 nuc systemd[1]: Starting Samba SMB Daemon... Apr 10 15:58:55 nuc systemd[1]: Started Samba SMB Daemon.   Set the password of the user which you want to use to access the samba server. You can use this command again if you forgot the password.\n1  wshi@nuc:~$ sudo smbpasswd -a wshi   Finially, create the share folder and set the right permissions 0777\n1 2  $ sudo mkdir /share $ sudo chmod 0777 /share   Disk Check - SMART The NAS system will be 24x7 running so we need some script to monitor its health. SMART is a good tool for monitoring HDD,SSD and eMMC drives.\nInstallation 1  $ sudo apt-get install smartmontools   Confirm SMART status Scan hard disk,\n1 2 3 4  $ sudo smartctl --scan /dev/sda -d scsi # /dev/sda, SCSI device /dev/sdb -d sat # /dev/sdb [SAT], ATA device /dev/nvme0 -d nvme # /dev/nvme0, NVMe device   Ensure the hard disk support SMART and is enable\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  $ sudo smartctl -i /dev/sda smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build) Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Model Family: Western Digital Green Device Model: WDC WD20EARX-00PASB0 Serial Number: WD-WCAZAE607205 LU WWN Device Id: 5 0014ee 20713dc7e Firmware Version: 51.0AB51 User Capacity: 2,000,398,934,016 bytes [2.00 TB] Sector Sizes: 512 bytes logical, 4096 bytes physical Device is: In smartctl database [for details use: -P show] ATA Version is: ATA8-ACS (minor revision not indicated) SATA Version is: SATA 3.0, 6.0 Gb/s (current: 6.0 Gb/s) Local Time is: Tue Apr 21 10:58:05 2020 JST SMART support is: Available - device has SMART capability. SMART support is: Enabled   The last 2 lines show whether SMART support is available and enabled.\nShow SMART infomation 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  $ sudo smartctl -A /dev/sda smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build) Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org === START OF READ SMART DATA SECTION === SMART Attributes Data Structure revision number: 16 Vendor Specific SMART Attributes with Thresholds: ID# ATTRIBUTE_NAME FLAG VALUE WORST THRESH TYPE UPDATED WHEN_FAILED RAW_VALUE 1 Raw_Read_Error_Rate 0x002f 200 200 051 Pre-fail Always - 1 3 Spin_Up_Time 0x0027 165 157 021 Pre-fail Always - 6716 4 Start_Stop_Count 0x0032 100 100 000 Old_age Always - 665 5 Reallocated_Sector_Ct 0x0033 200 200 140 Pre-fail Always - 0 7 Seek_Error_Rate 0x002e 200 200 000 Old_age Always - 0 9 Power_On_Hours 0x0032 098 098 000 Old_age Always - 1946 10 Spin_Retry_Count 0x0032 100 100 000 Old_age Always - 0 11 Calibration_Retry_Count 0x0032 100 100 000 Old_age Always - 0 12 Power_Cycle_Count 0x0032 100 100 000 Old_age Always - 616 192 Power-Off_Retract_Count 0x0032 200 200 000 Old_age Always - 39 193 Load_Cycle_Count 0x0032 196 196 000 Old_age Always - 13842 194 Temperature_Celsius 0x0022 127 099 000 Old_age Always - 23 196 Reallocated_Event_Count 0x0032 200 200 000 Old_age Always - 0 197 Current_Pending_Sector 0x0032 200 200 000 Old_age Always - 0 198 Offline_Uncorrectable 0x0030 200 200 000 Old_age Offline - 0 199 UDMA_CRC_Error_Count 0x0032 200 200 000 Old_age Always - 0 200 Multi_Zone_Error_Rate 0x0008 200 200 000 Old_age Offline - 0   Available Tests for the disk(SCSI) There are 2 types of tests:\nShort Test This test is the rapid identification of a defective hard drive. There fore, a maximum run time is 2 min. This test checks the disk by dividing it into 3 different segments. The following areas are tested.\n Electrical Properties: The controller tests its own electronics, and since this is specific to each manufacturer, it cannot be explained exactly what is being tested. It is conceivable, for example, to test the internal RAM, the read/write circuits or the head electronics. Mechanical Properties: The exact sequence of the servos and the positioning mechanism to be tested is also specific to each manufacturer. Read/Verify: It will read a certain area of the disk and verify certain data, the size and position of the region that is read is also specific to each manufacturer.  Long Test This test is designed as the final test in production. There is no time restriction and the entire disk is checked and not just a section.\nThere are also other test which only available for ATA hard drive. Conveyance Test and Select Test.\nPerform a test Before performing a test, you can use following command to show the time duration of the various tests\n1  $ sudo smartctl -c /dev/sdc   Example output\n1 2 3 4 5 6 7 8  ... Short self-test routine recommended polling time: ( 2) minutes. Extended self-test routine recommended polling time: ( 353) minutes. Conveyance self-test routine recommended polling time: ( 5) minutes. ...   The following command starts the desired test (in Background Mode)\n1  $ sudo smartctl -t  /dev/sda   For example,\n1 2 3 4 5 6 7 8 9 10 11  $ sudo smartctl -t short /dev/sda smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build) Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org === START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION === Sending command: \"Execute SMART Short self-test routine immediately in off-line mode\". Drive command \"Execute SMART Short self-test routine immediately in off-line mode\" successful. Testing has begun. Please wait 2 minutes for test to complete. Test will complete after Tue Apr 21 11:25:01 2020 JST Use smartctl -X to abort test.   The test will run in background and the priority of the test is low, which means the normal instructions continue to be processed by the hard disk. If the hard drive is busy, the test is paused and then continues at a lower load speed, so there is no interruption of the operation.\nThere is another Foreground mode which all commands will be answered during the test with a “CHECK CONDITION” status. Therefore, this mode is only recommended when the hard disk is not used. In principle, the background mode is the preferred mode.\nTo perform the tests in Foreground Mode a -C must be added to the command.\n1  $ sudo smartctl -t short -C /dev/sda   Verify the test result The test results are included in the output of the following:\n1  $ sudo smartctl -a /dev/sda   Example output\n1 2 3 4 5  ... SMART Self-test log structure revision number 1 Num Test_Description Status Remaining LifeTime(hours) LBA_of_first_error # 1 Short offline Completed without error 00% 1946 - ...   Or use the following, if only the test results should are displayed:\n1 2 3 4 5 6 7 8  $ sudo smartctl -l selftest /dev/sda smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build) Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org === START OF READ SMART DATA SECTION === SMART Self-test log structure revision number 1 Num Test_Description Status Remaining LifeTime(hours) LBA_of_first_error # 1 Short offline Completed without error 00% 1946 -   Force stop the test Use -X if you want to stop the test when performing.\n1 2 3 4 5 6 7  $ sudo smartctl -X /dev/sda smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build) Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org === START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION === Sending command: \"Abort SMART off-line mode self-test routine\". Self-testing aborted!   We can use this tool to check the disk status and send us email if anything need our attention.\nrefer [https://mekou.com/linux-magazine/smartctl-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E6%B4%BB%E5%8B%95%E3%81%AE%E8%A9%B3%E7%B4%B0%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%8E%E9%9B%86/](smartctl コマンドでディスク活動の詳細情報を収集)\n[https://www.thomas-krenn.com/en/wiki/SMART_tests_with_smartctl#ATA.2FSCSI_Tests](SMART tests with smartctl)\nMail - sendEmail(CLI) The NAS system will be 24x7 running so we need some script to monitor its health. If anything is not good it’s necessary to inform me by sending a mail. SendEmail is a lightweight, completely command line-based SMTP email delivery program. If you have the need to send email from a command prompt this tool is perfect.\nInstall SendEmail by following command\n1  $ sudo apt install sendemail   OK, let’s send a test mail by it.\n1 2 3 4 5 6 7 8 9  $ sendEmail -f @gmail.com \\ -s smtp.gmail.com:587 \\ -xu  \\ -xp  \\ -t @gmail.com \\ -u \"test title\" \\ -m \"test contents\" Apr 06 14:33:24 nuc sendEmail[24438]: NOTICE = Authentication not supported by the remote SMTP server! Apr 06 14:33:25 nuc sendEmail[24438]: ERROR = Received: 530 5.7.0 Must issue a STARTTLS command first. mm18sm11195078pjb.39 - gsmtp   Oops, it failed with unsupported error. And looks related to tls.\nLet’s specify the tls supported and re-run the command.\n1 2 3 4 5 6 7 8 9  $ sendEmail -f @gmail.com \\ -s smtp.gmail.com:587 \\ -xu  \\ -xp  \\ -t @gmail.com \\ -u \"test title\" \\ -m \"test contents\" \\ -o tls=yes Apr 06 15:16:10 nuc sendEmail[25354]: ERROR = No TLS support! SendEmail can't load required libraries. (try installing Net::SSLeay and IO::Socket::SSL)   We got a different message, and the root cause is we need more libraries. There are 2 packages we need to install.\n1 2  $ sudo apt-get install libnet-ssleay-perl $ sudo apt-get install libio-socket-ssl-perl   Re-run the command and we can send email from CLI. :-)\n1  Apr 06 15:17:28 nuc sendEmail[25507]: Email was sent successfully!   docker management - portainer There are a lot of docker image for a better NAS life, so let’s install and setup Portainer first. Portainer gives you a detailed overview of your Docker environments and allows you to manage your containers, images, networks and volumes. Install protainer is easy as it can be deployed as a container. Use the following command to deploy the Portainer Server.\n1 2  $ docker volume create portainer_data $ docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer   Please note the  -v /var/run/docker.sock:/var/run/docker.sock works in Linux environment only.\nIf your container runs successfully, You can now login to https://:9000/ to access the protainer dashboard. First it will ask you a new password for admin user. Connect your local docker engine environment and you can see something as follows.\nmulti-media - Emby server Emby is a media server designed to organize, play, and stream audio and video to a variety of devices.\nThe install is very easy, you can start a container to run Emby server. There is a Installation Guide on First pull the latest image\n1  docker pull emby/embyserver:latest   Then just launch a new container using the following command\n1 2 3 4 5 6 7 8 9 10 11 12  docker run -d \\ --volume /path/to/programdata:/config \\ # This is mandatory --volume /path/to/share1:/mnt/share1 \\ # To mount a first share --volume /path/to/share2:/mnt/share2 \\ # To mount a second share --device /dev/dri:/dev/dri \\ # To mount all render nodes for VAAPI/NVDEC/NVENC --runtime=nvidia \\ # To expose your NVIDIA GPU --publish 8096:8096 \\ # To expose the HTTP port --publish 8920:8920 \\ # To expose the HTTPS port --env UID=1000 \\ # The UID to run emby as (default: 2) --env GID=100 \\ # The GID to run emby as (default 2) --env GIDLIST=100 \\ # A comma-separated list of additional GIDs to run emby as (default: 2) emby/embyserver:latest   Above one is from the offical guide, but you don’t need to set all the options. Some of the options are not necessary to change, if you ignore it the default setting will work. Let me paste the command works for me.\n1 2 3 4 5  $ sudo docker run -d --volume /share/movie:/mnt/share1 \\ --publish 8096:8096 \\ --env UID=`id -u` \\ --env GID=`id -g` \\ emby/embyserver:latest   If your container runs successfully, You can now login to https://:8096/ to access the Emby site, and follow the guide to set your environment.\nThere is one important setting about the subtitles, you need to create a new account at https://www.opensubtitles.org/, and set your username/password in Emby. Then you should download subtitle in Emby, this is super helpful.\nWeb control pannel - webmin Webmin is a web-based interface for system administration for Unix. Using any modern web browser, you can setup user accounts, Apache, DNS, file sharing and much more. Webmin removes the need to manually edit Unix configuration files like /etc/passwd, and lets you manage a system from the console or remotely. See the standard modules page for a list of all the functions built into Webmin.\nThe install of webmin is easy. First need to import the webmin GPG key and the apt-repository. Then you can just install webmin via apt command.\n1 2 3  $ wget -q http://www.webmin.com/jcameron-key.asc -O- | sudo apt-key add - $ sudo add-apt-repository \"deb [arch=amd64] http://download.webmin.com/download/repository sarge contrib\" $ sudo apt install webmin   After the install, a message will be displayed as follows. Access the URL with the username and password in the host machine to login to the webUI.\n1 2 3  Webmin install complete. You can now login to https://:10000/ as root with your root password, or as any user who can use sudo to run commands as root.   The dashboard is like this Then you can check or modify contents/settings on the host machine. For example, to check the files, click Others-FIle Manager.\nIf your system is behind a UFW firewall, you may need to open the 10000 port which is used by default to listen connections.\nTo alow traffic on port 10000 run the following command.\n1  $ sudo ufw allow 10000/tcp   Refers to\nhttps://www.digitalocean.com/community/tutorials/how-to-install-webmin-on-ubuntu-18-04\nhttps://linuxize.com/post/how-to-install-webmin-on-ubuntu-18-04/\n","wordCount":"2499","inLanguage":"en","datePublished":"2020-04-05T15:22:58+09:00","dateModified":"2020-04-05T15:22:58+09:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wenhan.blog/post/self-nas-environment-project/"},"publisher":{"@type":"Organization","name":"Wenhan blog","logo":{"@type":"ImageObject","url":"https://media.licdn.com/dms/image/C4D03AQHsFHxbDCgPsA/profile-displayphoto-shrink_400_400/0/1517015003915?e=1683763200\u0026v=beta\u0026t=PR0k2MbOHcJjtozRAQipgSz2CGprYxywDGgXInkOXmo"}}}</script>
</head><body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://wenhan.blog/ accesskey=h title="Home (Alt + H)">
<img src=https://wenhan.blog/apple-touch-icon.png alt aria-label=logo height=35>Home</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div></div><ul id=menu>
<li>
<a href=https://wenhan.blog/tags/ title=tags>
<span>tags</span>
</a>
</li></ul></nav></header><main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://wenhan.blog/>Home</a>&nbsp;»&nbsp;<a href=https://wenhan.blog/post/>Posts</a></div><h1 class=post-title>
Self Nas Environment Project
</h1><div class=post-meta><span title="2020-04-05 15:22:58 +0900 +0900">April 5, 2020</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2499 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/self-nas-environment-project.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div></header><div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><nav id=TableOfContents>
<ul>
<li><a href=#installation>Installation</a></li><li><a href=#confirm-smart-status>Confirm SMART status</a></li><li><a href=#show-smart-infomation>Show SMART infomation</a></li><li><a href=#available-tests-for-the-diskscsi>Available Tests for the disk(SCSI)</a>
<ul>
<li><a href=#short-test>Short Test</a></li><li><a href=#long-test>Long Test</a></li></ul></li><li><a href=#perform-a-test>Perform a test</a></li><li><a href=#verify-the-test-result>Verify the test result</a></li><li><a href=#force-stop-the-test>Force stop the test</a></li><li><a href=#refer>refer</a></li></ul></nav></div></details>
</div><div class=post-content><p>This artcle is a note for myself to build a private NAS station using Ubuntu
20.04. The main usage of my NAS is to store photoes.
For other services, run webmin to control machine via WebUI, and run Emby/
Jellyfin for multi media. Above 2 will run in docker so I also run portainer
to manage them.</p><h1 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h1><p>Use Samba to share storage, and use <code>PhotoSync</code> to upload photoes from iPhone
to NAS. Use smartctl to check the disk condition, if anything need attention
send a mail to me.</p><h1 id=file-share-samba>File share (Samba)<a hidden class=anchor aria-hidden=true href=#file-share-samba>#</a></h1><p>Install Samba by the following:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt-get install samba smbfs
</span></span></code></pre></td></tr></table></div></div><p>Configure samba settings by opening <code>/etc/samba/smb.conf</code>,
If needed, change your workgroup</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Change this to the workgroup/NT-domain name your Samba server will part of
</span></span><span class=line><span class=cl>   workgroup = WORKGROUP
</span></span></code></pre></td></tr></table></div></div><p>Next is to set your share folder, input something like this at the end of the
file.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[share]
</span></span><span class=line><span class=cl>   comment = Share directory for my self-nas
</span></span><span class=line><span class=cl>   path = /share
</span></span><span class=line><span class=cl>   read only = no
</span></span><span class=line><span class=cl>   guest only = no
</span></span><span class=line><span class=cl>   guest ok = no
</span></span><span class=line><span class=cl>   share modes = yes
</span></span></code></pre></td></tr></table></div></div><p>Restart <code>smbd</code> service and confirm the service is running.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wshi@nuc:~$ sudo systemctl restart smbd
</span></span><span class=line><span class=cl>wshi@nuc:~$ sudo systemctl status smbd
</span></span><span class=line><span class=cl>● smbd.service - Samba SMB Daemon
</span></span><span class=line><span class=cl>   Loaded: loaded (/lib/systemd/system/smbd.service; enabled; vendor preset: enabled)
</span></span><span class=line><span class=cl>   Active: active (running) since Fri 2020-04-10 15:58:55 JST; 3s ago
</span></span><span class=line><span class=cl>     Docs: man:smbd(8)
</span></span><span class=line><span class=cl>           man:samba(7)
</span></span><span class=line><span class=cl>           man:smb.conf(5)
</span></span><span class=line><span class=cl> Main PID: 7696 (smbd)
</span></span><span class=line><span class=cl>   Status: &#34;smbd: ready to serve connections...&#34;
</span></span><span class=line><span class=cl>    Tasks: 4 (limit: 4915)
</span></span><span class=line><span class=cl>   CGroup: /system.slice/smbd.service
</span></span><span class=line><span class=cl>           ├─7696 /usr/sbin/smbd --foreground --no-process-group
</span></span><span class=line><span class=cl>           ├─7712 /usr/sbin/smbd --foreground --no-process-group
</span></span><span class=line><span class=cl>           ├─7713 /usr/sbin/smbd --foreground --no-process-group
</span></span><span class=line><span class=cl>           └─7722 /usr/sbin/smbd --foreground --no-process-group
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Apr 10 15:58:55 nuc systemd[1]: Starting Samba SMB Daemon...
</span></span><span class=line><span class=cl>Apr 10 15:58:55 nuc systemd[1]: Started Samba SMB Daemon.
</span></span></code></pre></td></tr></table></div></div><p>Set the password of the user which you want to use to access the samba server.
You can use this command again if you forgot the password.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wshi@nuc:~$ sudo smbpasswd -a wshi
</span></span></code></pre></td></tr></table></div></div><p>Finially, create the share folder and set the right permissions <code>0777</code></p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo mkdir /share
</span></span><span class=line><span class=cl>$ sudo chmod 0777 /share
</span></span></code></pre></td></tr></table></div></div><h1 id=disk-check---smart>Disk Check - SMART<a hidden class=anchor aria-hidden=true href=#disk-check---smart>#</a></h1><p>The NAS system will be 24x7 running so we need some script to monitor its
health. SMART is a good tool for monitoring HDD,SSD and eMMC drives.</p><h2 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo apt-get install smartmontools
</span></span></code></pre></td></tr></table></div></div><h2 id=confirm-smart-status>Confirm SMART status<a hidden class=anchor aria-hidden=true href=#confirm-smart-status>#</a></h2><p>Scan hard disk,</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl --scan     
</span></span><span class=line><span class=cl>/dev/sda -d scsi # /dev/sda, SCSI device
</span></span><span class=line><span class=cl>/dev/sdb -d sat # /dev/sdb [SAT], ATA device
</span></span><span class=line><span class=cl>/dev/nvme0 -d nvme # /dev/nvme0, NVMe device
</span></span></code></pre></td></tr></table></div></div><p>Ensure the hard disk support SMART and is enable</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -i /dev/sda  
</span></span><span class=line><span class=cl>smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
</span></span><span class=line><span class=cl>Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== START OF INFORMATION SECTION ===
</span></span><span class=line><span class=cl>Model Family:     Western Digital Green
</span></span><span class=line><span class=cl>Device Model:     WDC WD20EARX-00PASB0
</span></span><span class=line><span class=cl>Serial Number:    WD-WCAZAE607205
</span></span><span class=line><span class=cl>LU WWN Device Id: 5 0014ee 20713dc7e
</span></span><span class=line><span class=cl>Firmware Version: 51.0AB51
</span></span><span class=line><span class=cl>User Capacity:    2,000,398,934,016 bytes [2.00 TB]
</span></span><span class=line><span class=cl>Sector Sizes:     512 bytes logical, 4096 bytes physical
</span></span><span class=line><span class=cl>Device is:        In smartctl database [for details use: -P show]
</span></span><span class=line><span class=cl>ATA Version is:   ATA8-ACS (minor revision not indicated)
</span></span><span class=line><span class=cl>SATA Version is:  SATA 3.0, 6.0 Gb/s (current: 6.0 Gb/s)
</span></span><span class=line><span class=cl>Local Time is:    Tue Apr 21 10:58:05 2020 JST
</span></span><span class=line><span class=cl>SMART support is: Available - device has SMART capability.
</span></span><span class=line><span class=cl>SMART support is: Enabled
</span></span></code></pre></td></tr></table></div></div><p>The last 2 lines show whether SMART support is available and enabled.</p><h2 id=show-smart-infomation>Show SMART infomation<a hidden class=anchor aria-hidden=true href=#show-smart-infomation>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -A /dev/sda
</span></span><span class=line><span class=cl>smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
</span></span><span class=line><span class=cl>Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== START OF READ SMART DATA SECTION ===
</span></span><span class=line><span class=cl>SMART Attributes Data Structure revision number: 16
</span></span><span class=line><span class=cl>Vendor Specific SMART Attributes with Thresholds:
</span></span><span class=line><span class=cl>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE
</span></span><span class=line><span class=cl>  1 Raw_Read_Error_Rate     0x002f   200   200   051    Pre-fail  Always       -       1
</span></span><span class=line><span class=cl>  3 Spin_Up_Time            0x0027   165   157   021    Pre-fail  Always       -       6716
</span></span><span class=line><span class=cl>  4 Start_Stop_Count        0x0032   100   100   000    Old_age   Always       -       665
</span></span><span class=line><span class=cl>  5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0
</span></span><span class=line><span class=cl>  7 Seek_Error_Rate         0x002e   200   200   000    Old_age   Always       -       0
</span></span><span class=line><span class=cl>  9 Power_On_Hours          0x0032   098   098   000    Old_age   Always       -       1946
</span></span><span class=line><span class=cl> 10 Spin_Retry_Count        0x0032   100   100   000    Old_age   Always       -       0
</span></span><span class=line><span class=cl> 11 Calibration_Retry_Count 0x0032   100   100   000    Old_age   Always       -       0
</span></span><span class=line><span class=cl> 12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       616
</span></span><span class=line><span class=cl>192 Power-Off_Retract_Count 0x0032   200   200   000    Old_age   Always       -       39
</span></span><span class=line><span class=cl>193 Load_Cycle_Count        0x0032   196   196   000    Old_age   Always       -       13842
</span></span><span class=line><span class=cl>194 Temperature_Celsius     0x0022   127   099   000    Old_age   Always       -       23
</span></span><span class=line><span class=cl>196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0
</span></span><span class=line><span class=cl>197 Current_Pending_Sector  0x0032   200   200   000    Old_age   Always       -       0
</span></span><span class=line><span class=cl>198 Offline_Uncorrectable   0x0030   200   200   000    Old_age   Offline      -       0
</span></span><span class=line><span class=cl>199 UDMA_CRC_Error_Count    0x0032   200   200   000    Old_age   Always       -       0
</span></span><span class=line><span class=cl>200 Multi_Zone_Error_Rate   0x0008   200   200   000    Old_age   Offline      -       0
</span></span></code></pre></td></tr></table></div></div><h2 id=available-tests-for-the-diskscsi>Available Tests for the disk(SCSI)<a hidden class=anchor aria-hidden=true href=#available-tests-for-the-diskscsi>#</a></h2><p>There are 2 types of tests:</p><h3 id=short-test>Short Test<a hidden class=anchor aria-hidden=true href=#short-test>#</a></h3><p>This test is the rapid identification of a defective hard drive.
There fore, a maximum run time is 2 min. This test checks the disk by
dividing it into 3 different segments. The following areas are tested.</p><ul>
<li>Electrical Properties: The controller tests its own electronics, and since this is specific to each manufacturer, it cannot be explained exactly what is being tested. It is conceivable, for example, to test the internal RAM, the read/write circuits or the head electronics.</li><li>Mechanical Properties: The exact sequence of the servos and the positioning mechanism to be tested is also specific to each manufacturer.</li><li>Read/Verify: It will read a certain area of the disk and verify certain data, the size and position of the region that is read is also specific to each manufacturer.</li></ul><h3 id=long-test>Long Test<a hidden class=anchor aria-hidden=true href=#long-test>#</a></h3><p>This test is designed as the final test in production. There is no time restriction and the entire disk is checked and not just a section.</p><p>There are also other test which only available for ATA hard drive.
Conveyance Test and Select Test.</p><h2 id=perform-a-test>Perform a test<a hidden class=anchor aria-hidden=true href=#perform-a-test>#</a></h2><p>Before performing a test, you can use following command to show the time
duration of the various tests</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -c /dev/sdc
</span></span></code></pre></td></tr></table></div></div><p>Example output</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Short self-test routine 
</span></span><span class=line><span class=cl>recommended polling time:        (   2) minutes.
</span></span><span class=line><span class=cl>Extended self-test routine
</span></span><span class=line><span class=cl>recommended polling time:        ( 353) minutes.
</span></span><span class=line><span class=cl>Conveyance self-test routine
</span></span><span class=line><span class=cl>recommended polling time:        (   5) minutes.
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>The following command starts the desired test (in Background Mode)</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -t &lt;short|long|conveyance|select&gt; /dev/sda
</span></span></code></pre></td></tr></table></div></div><p>For example,</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -t short /dev/sda
</span></span><span class=line><span class=cl>smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
</span></span><span class=line><span class=cl>Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION ===
</span></span><span class=line><span class=cl>Sending command: &#34;Execute SMART Short self-test routine immediately in off-line mode&#34;.
</span></span><span class=line><span class=cl>Drive command &#34;Execute SMART Short self-test routine immediately in off-line mode&#34; successful.
</span></span><span class=line><span class=cl>Testing has begun.
</span></span><span class=line><span class=cl>Please wait 2 minutes for test to complete.
</span></span><span class=line><span class=cl>Test will complete after Tue Apr 21 11:25:01 2020 JST
</span></span><span class=line><span class=cl>Use smartctl -X to abort test.
</span></span></code></pre></td></tr></table></div></div><p>The test will run in background and the priority of the test is low, which means
the normal instructions continue to be processed by the hard disk. If the hard
drive is busy, the test is paused and then continues at a lower load speed, so
there is no interruption of the operation.</p><p>There is another <code>Foreground</code> mode which all commands will be answered during
the test with a &ldquo;CHECK CONDITION&rdquo; status. Therefore, this mode is only
recommended when the hard disk is not used. In principle, the background mode
is the preferred mode.</p><p>To perform the tests in Foreground Mode a <code>-C</code> must be added to the command.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -t short -C /dev/sda
</span></span></code></pre></td></tr></table></div></div><h2 id=verify-the-test-result>Verify the test result<a hidden class=anchor aria-hidden=true href=#verify-the-test-result>#</a></h2><p>The test results are included in the output of the following:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -a /dev/sda
</span></span></code></pre></td></tr></table></div></div><p>Example output</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>SMART Self-test log structure revision number 1
</span></span><span class=line><span class=cl>Num  Test_Description    Status                  Remaining  LifeTime(hours)  LBA_of_first_error
</span></span><span class=line><span class=cl># 1  Short offline       Completed without error       00%      1946         -
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>Or use the following, if only the test results should are displayed:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -l selftest /dev/sda
</span></span><span class=line><span class=cl>smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
</span></span><span class=line><span class=cl>Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== START OF READ SMART DATA SECTION ===
</span></span><span class=line><span class=cl>SMART Self-test log structure revision number 1
</span></span><span class=line><span class=cl>Num  Test_Description    Status                  Remaining  LifeTime(hours)  LBA_of_first_error
</span></span><span class=line><span class=cl># 1  Short offline       Completed without error       00%      1946         -
</span></span></code></pre></td></tr></table></div></div><h2 id=force-stop-the-test>Force stop the test<a hidden class=anchor aria-hidden=true href=#force-stop-the-test>#</a></h2><p>Use <code>-X</code> if you want to stop the test when performing.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo smartctl -X /dev/sda
</span></span><span class=line><span class=cl>smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.0-25-generic] (local build)
</span></span><span class=line><span class=cl>Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION ===
</span></span><span class=line><span class=cl>Sending command: &#34;Abort SMART off-line mode self-test routine&#34;.
</span></span><span class=line><span class=cl>Self-testing aborted!
</span></span></code></pre></td></tr></table></div></div><p>We can use this tool to check the disk status and send us email if anything
need our attention.</p><h2 id=refer>refer<a hidden class=anchor aria-hidden=true href=#refer>#</a></h2><p>[https://mekou.com/linux-magazine/smartctl-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E6%B4%BB%E5%8B%95%E3%81%AE%E8%A9%B3%E7%B4%B0%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%8E%E9%9B%86/](smartctl コマンドでディスク活動の詳細情報を収集)</p><p>[https://www.thomas-krenn.com/en/wiki/SMART_tests_with_smartctl#ATA.2FSCSI_Tests](SMART tests with smartctl)</p><h1 id=mail---sendemailcli>Mail - sendEmail(CLI)<a hidden class=anchor aria-hidden=true href=#mail---sendemailcli>#</a></h1><p>The NAS system will be 24x7 running so we need some script to monitor its
health. If anything is not good it&rsquo;s necessary to inform me by sending a mail.
SendEmail is a lightweight, completely command line-based SMTP email delivery
program. If you have the need to send email from a command prompt this tool is
perfect.</p><p>Install SendEmail by following command</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo apt install sendemail
</span></span></code></pre></td></tr></table></div></div><p>OK, let&rsquo;s send a test mail by it.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sendEmail -f &lt;FROM ADDRESS&gt;@gmail.com \
</span></span><span class=line><span class=cl>            -s smtp.gmail.com:587 \
</span></span><span class=line><span class=cl>            -xu &lt;USERNAME&gt; \
</span></span><span class=line><span class=cl>            -xp &lt;PASSWORD&gt; \
</span></span><span class=line><span class=cl>            -t &lt;TO ADDRESS&gt;@gmail.com  \
</span></span><span class=line><span class=cl>            -u &#34;test title&#34; \
</span></span><span class=line><span class=cl>            -m &#34;test contents&#34;
</span></span><span class=line><span class=cl>Apr 06 14:33:24 nuc sendEmail[24438]: NOTICE =&gt; Authentication not supported by the remote SMTP server!
</span></span><span class=line><span class=cl>Apr 06 14:33:25 nuc sendEmail[24438]: ERROR =&gt; Received: 	530 5.7.0 Must issue a STARTTLS command first. mm18sm11195078pjb.39 - gsmtp
</span></span></code></pre></td></tr></table></div></div><p>Oops, it failed with unsupported error. And looks related to tls.</p><p>Let&rsquo;s specify the tls supported and re-run the command.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sendEmail -f &lt;FROM ADDRESS&gt;@gmail.com \
</span></span><span class=line><span class=cl>            -s smtp.gmail.com:587 \
</span></span><span class=line><span class=cl>            -xu &lt;USERNAME&gt; \
</span></span><span class=line><span class=cl>            -xp &lt;PASSWORD&gt; \
</span></span><span class=line><span class=cl>            -t &lt;TO ADDRESS&gt;@gmail.com  \
</span></span><span class=line><span class=cl>            -u &#34;test title&#34; \ 
</span></span><span class=line><span class=cl>            -m &#34;test contents&#34; \
</span></span><span class=line><span class=cl>            -o tls=yes
</span></span><span class=line><span class=cl>Apr 06 15:16:10 nuc sendEmail[25354]: ERROR =&gt; No TLS support!  SendEmail can&#39;t load required libraries. (try installing Net::SSLeay and IO::Socket::SSL)
</span></span></code></pre></td></tr></table></div></div><p>We got a different message, and the root cause is we need more libraries. There
are 2 packages we need to install.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo apt-get install libnet-ssleay-perl
</span></span><span class=line><span class=cl>$ sudo apt-get install libio-socket-ssl-perl
</span></span></code></pre></td></tr></table></div></div><p>Re-run the command and we can send email from CLI. :-)</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Apr 06 15:17:28 nuc sendEmail[25507]: Email was sent successfully!
</span></span></code></pre></td></tr></table></div></div><h1 id=docker-management---portainer>docker management - portainer<a hidden class=anchor aria-hidden=true href=#docker-management---portainer>#</a></h1><p>There are a lot of docker image for a better NAS life, so let&rsquo;s install and
setup Portainer first.
Portainer gives you a detailed overview of your Docker environments and allows
you to manage your containers, images, networks and volumes.
Install protainer is easy as it can be deployed as a container. Use the
following command to deploy the Portainer Server.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ docker volume create portainer_data
</span></span><span class=line><span class=cl>$ docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
</span></span></code></pre></td></tr></table></div></div><p>Please note the <code> -v /var/run/docker.sock:/var/run/docker.sock</code> works in Linux
environment only.</p><p>If your container runs successfully, You can now login to <code>https://&lt;SERVER IP ADDR>:9000/</code> to access the protainer dashboard. First it will ask you a new
password for admin user. Connect your local docker engine environment and you
can see something as follows.</p><p><img loading=lazy src=/img/2020-04-06_11-38.png alt=protainer_dashboard>
</p><h1 id=multi-media----emby-server>multi-media - Emby server<a hidden class=anchor aria-hidden=true href=#multi-media----emby-server>#</a></h1><p>Emby is a media server designed to organize, play, and stream audio and video
to a variety of devices.</p><p>The install is very easy, you can start a container to run Emby server. There
is a Installation Guide on <img loading=lazy src=https://hub.docker.com/r/emby/embyserver#installation alt=dockerhub>
</p><p>First pull the latest image</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker pull emby/embyserver:latest
</span></span></code></pre></td></tr></table></div></div><p>Then just launch a new container using the following command</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -d \
</span></span><span class=line><span class=cl>    --volume /path/to/programdata:/config \ # This is mandatory
</span></span><span class=line><span class=cl>    --volume /path/to/share1:/mnt/share1 \ # To mount a first share
</span></span><span class=line><span class=cl>    --volume /path/to/share2:/mnt/share2 \ # To mount a second share
</span></span><span class=line><span class=cl>    --device /dev/dri:/dev/dri \ # To mount all render nodes for VAAPI/NVDEC/NVENC
</span></span><span class=line><span class=cl>    --runtime=nvidia \ # To expose your NVIDIA GPU
</span></span><span class=line><span class=cl>    --publish 8096:8096 \ # To expose the HTTP port
</span></span><span class=line><span class=cl>    --publish 8920:8920 \ # To expose the HTTPS port
</span></span><span class=line><span class=cl>    --env UID=1000 \ # The UID to run emby as (default: 2)
</span></span><span class=line><span class=cl>    --env GID=100 \ # The GID to run emby as (default 2)
</span></span><span class=line><span class=cl>    --env GIDLIST=100 \ # A comma-separated list of additional GIDs to run emby as (default: 2)
</span></span><span class=line><span class=cl>    emby/embyserver:latest
</span></span></code></pre></td></tr></table></div></div><p>Above one is from the offical guide, but you don&rsquo;t need to set all the options.
Some of the options are not necessary to change, if you ignore it the default
setting will work. Let me paste the command works for me.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo docker run -d  --volume /share/movie:/mnt/share1 \
</span></span><span class=line><span class=cl>                      --publish 8096:8096  \
</span></span><span class=line><span class=cl>                      --env UID=`id -u` \
</span></span><span class=line><span class=cl>                      --env GID=`id -g` \
</span></span><span class=line><span class=cl>                      emby/embyserver:latest
</span></span></code></pre></td></tr></table></div></div><p>If your container runs successfully, You can now login to <code>https://&lt;SERVER IP ADDR>:8096/</code> to access the Emby site, and follow the guide to set your
environment.</p><p>There is one important setting about the subtitles, you need to create a new
account at <a href=https://www.opensubtitles.org/>https://www.opensubtitles.org/</a>, and set your username/password in
Emby. Then you should download subtitle in Emby, this is super helpful.</p><h1 id=web-control-pannel---webmin>Web control pannel - webmin<a hidden class=anchor aria-hidden=true href=#web-control-pannel---webmin>#</a></h1><p>Webmin is a web-based interface for system administration for Unix. Using any
modern web browser, you can setup user accounts, Apache, DNS, file sharing and
much more. Webmin removes the need to manually edit Unix configuration files
like /etc/passwd, and lets you manage a system from the console or remotely.
See the standard modules page for a list of all the functions built into
Webmin.</p><p>The install of webmin is easy. First need to import the webmin GPG key and the
apt-repository. Then you can just install webmin via <code>apt</code> command.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ wget -q http://www.webmin.com/jcameron-key.asc -O- | sudo apt-key add -
</span></span><span class=line><span class=cl>$ sudo add-apt-repository &#34;deb [arch=amd64] http://download.webmin.com/download/repository sarge contrib&#34;
</span></span><span class=line><span class=cl>$ sudo apt install webmin
</span></span></code></pre></td></tr></table></div></div><p>After the install, a message will be displayed as follows. Access the URL with
the username and password in the host machine to login to the webUI.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Webmin install complete. You can now login to https://&lt;SERVER IP ADDR&gt;:10000/
</span></span><span class=line><span class=cl>as root with your root password, or as any user who can use sudo
</span></span><span class=line><span class=cl>to run commands as root.
</span></span></code></pre></td></tr></table></div></div><p>The dashboard is like this
<img loading=lazy src=/img/2020-04-05_16-29.png alt=dashboard>
</p><p>Then you can check or modify contents/settings on the host machine.
For example, to check the files, click <code>Others->FIle Manager</code>.</p><p><img loading=lazy src=/img/2020-04-05_16-35.png alt=filemanager>
</p><p>If your system is behind a UFW firewall, you may need to open the 10000 port
which is used by default to listen connections.</p><p>To alow traffic on port <code>10000</code> run the following command.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo ufw allow 10000/tcp
</span></span></code></pre></td></tr></table></div></div><p>Refers to</p><p><a href=https://www.digitalocean.com/community/tutorials/how-to-install-webmin-on-ubuntu-18-04>https://www.digitalocean.com/community/tutorials/how-to-install-webmin-on-ubuntu-18-04</a></p><p><a href=https://linuxize.com/post/how-to-install-webmin-on-ubuntu-18-04/>https://linuxize.com/post/how-to-install-webmin-on-ubuntu-18-04/</a></p></div><footer class=post-footer>
<ul class=post-tags>
</ul><nav class=paginav>
<a class=prev href=https://wenhan.blog/post/install-linux-os-with-qemu-cli/>
<span class=title>« Prev</span>
<br>
<span>Install Linux OS With Qemu CLI</span>
</a>
<a class=next href=https://wenhan.blog/post/multipass-launch-failed-by-network-timeout/>
<span class=title>Next »</span>
<br>
<span>Multipass Launch Failed by Network Timeout</span>
</a>
</nav><div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Self Nas Environment Project on twitter" href="https://twitter.com/intent/tweet/?text=Self%20Nas%20Environment%20Project&url=https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Self Nas Environment Project on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f&title=Self%20Nas%20Environment%20Project&summary=Self%20Nas%20Environment%20Project&source=https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Self Nas Environment Project on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f&title=Self%20Nas%20Environment%20Project"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Self Nas Environment Project on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Self Nas Environment Project on whatsapp" href="https://api.whatsapp.com/send?text=Self%20Nas%20Environment%20Project%20-%20https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Self Nas Environment Project on telegram" href="https://telegram.me/share/url?text=Self%20Nas%20Environment%20Project&url=https%3a%2f%2fwenhan.blog%2fpost%2fself-nas-environment-project%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div></footer></article></main><footer class=footer>
<span>&copy; 2023 <a href=https://wenhan.blog/>Wenhan blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script>
<script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script>
</body></html>