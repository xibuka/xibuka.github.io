<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Certified Kubernetes Administrator (CKA) learning note | Wenhan blog</title><meta name=keywords content="Kubernetes,CKA">
<meta name=description content="Install  Install docker.io  1  apt install docker.io   If you install docker with other cgroup driver, you have to make sure that docker and Kubernetes will use same cgroup driver.
1 2 3 4 5  cat << EOF >> /etc/docker/daemon.json { &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;] } EOF    install apt key and source to system  1 2 3 4 5  root@kube-master:~# curl -s https://packages.">
<meta name=author content="Me">
<link rel=canonical href=https://wenhan.blog/post/certified-kubernetes-administrator-cka-learning-note/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href="https://media.licdn.com/dms/image/C4D03AQHsFHxbDCgPsA/profile-displayphoto-shrink_400_400/0/1517015003915?e=1683763200&v=beta&t=PR0k2MbOHcJjtozRAQipgSz2CGprYxywDGgXInkOXmo">
<link rel=icon type=image/png sizes=16x16 href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://wenhan.blog/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-87273435-2","auto"),ga("send","pageview"))</script><meta property="og:title" content="Certified Kubernetes Administrator (CKA) learning note">
<meta property="og:description" content="Install  Install docker.io  1  apt install docker.io   If you install docker with other cgroup driver, you have to make sure that docker and Kubernetes will use same cgroup driver.
1 2 3 4 5  cat << EOF >> /etc/docker/daemon.json { &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;] } EOF    install apt key and source to system  1 2 3 4 5  root@kube-master:~# curl -s https://packages.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://wenhan.blog/post/certified-kubernetes-administrator-cka-learning-note/"><meta property="og:image" content="https://wenhan.blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post">
<meta property="article:published_time" content="2018-08-29T11:40:56+00:00">
<meta property="article:modified_time" content="2018-08-29T11:40:56+00:00"><meta property="og:site_name" content="Wenhan blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://wenhan.blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Certified Kubernetes Administrator (CKA) learning note">
<meta name=twitter:description content="Install  Install docker.io  1  apt install docker.io   If you install docker with other cgroup driver, you have to make sure that docker and Kubernetes will use same cgroup driver.
1 2 3 4 5  cat << EOF >> /etc/docker/daemon.json { &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;] } EOF    install apt key and source to system  1 2 3 4 5  root@kube-master:~# curl -s https://packages.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wenhan.blog/post/"},{"@type":"ListItem","position":2,"name":"Certified Kubernetes Administrator (CKA) learning note","item":"https://wenhan.blog/post/certified-kubernetes-administrator-cka-learning-note/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Certified Kubernetes Administrator (CKA) learning note","name":"Certified Kubernetes Administrator (CKA) learning note","description":"Install  Install docker.io  1  apt install docker.io   If you install docker with other cgroup driver, you have to make sure that docker and Kubernetes will use same cgroup driver.\n1 2 3 4 5  cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json { \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;] } EOF    install apt key and source to system  1 2 3 4 5  root@kube-master:~# curl -s https://packages.","keywords":["Kubernetes","CKA"],"articleBody":"Install  Install docker.io  1  apt install docker.io   If you install docker with other cgroup driver, you have to make sure that docker and Kubernetes will use same cgroup driver.\n1 2 3 4 5  cat  /etc/docker/daemon.json { \"exec-opts\": [\"native.cgroupdriver=systemd\"] } EOF    install apt key and source to system  1 2 3 4 5  root@kube-master:~# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - OK root@kube-master:~# cat  /etc/apt/sources.list.d/kubernetes.list  deb http://apt.kubernetes.io/ kubernetes-xenial main  EOF   Then install kubernetes packages\n1 2  root@kube-master:~# apt update -y root@kube-master:~# apt install -y kubelet kubeadm kubectl    setup and config with kubeadm  You must choose a CNI when you execute kubeadm init, in this post I choose flunnel, so I have to add --pod-network-cidr options.\n1  root@k8sm:~# kubeadm init --pod-network-cidr=10.244.0.0/16   after waiting for some while, you should see below message that shows the install is complete\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  Your Kubernetes master has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config You should now deploy a pod network to the cluster. Run \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ You can now join any number of machines by running the following on each node as root: kubeadm join 192.168.122.75:6443 --token .....   Follow the instruction, run below comand as a regular user\n1 2 3  mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config   And you need to memo the command start with kubeadm join, you will need to exeute this command on your kubernetes node to join to the cluster\nIn order for your pods to communicate with one another, you’ll need to install pod networking. We are going to use Flannel for our Container Network Interface (CNI) because it’s easy to install and reliable. Enter this command:\n1  kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml   Next run below command to make sure everything is coming up.\n1  kubectl get pods --all-namespaces   If you see the coredns-xxxxxx pod is running, and your master node is Ready, your cluster is ready to accept worker nodes.\n1 2 3 4 5 6 7 8 9 10 11 12 13  wshi@k8sm:~$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-78fcdf6894-ltgw2 1/1 Running 0 17m kube-system coredns-78fcdf6894-n8hw2 1/1 Running 0 17m kube-system etcd-k8sm 1/1 Running 0 16m kube-system kube-apiserver-k8sm 1/1 Running 0 16m kube-system kube-controller-manager-k8sm 1/1 Running 0 16m kube-system kube-flannel-ds-amd64-ktcqm 1/1 Running 0 1m kube-system kube-proxy-nczhf 1/1 Running 0 17m kube-system kube-scheduler-k8sm 1/1 Running 0 16m wshi@k8sm:~$ kubectl get node NAME STATUS ROLES AGE VERSION k8sm Ready master 17m v1.11.2    setup other node and join to the cluster  For the rest worker nodes, you just need to install kubectl, kubeadm, kubelet and docker refer above, then execute the kubeadm join ... command which was mentioned before. After a while, you should see all worker nodes are ready to use.\n1 2 3 4 5  wshi@k8sm:~$ kubectl get node NAME STATUS ROLES AGE VERSION k8sm Ready master 44m v1.11.2 k8sn1 Ready  11m v1.11.2 k8sn2 Ready  11m v1.11.2   Run a Job Applications that running inside a pod are called “jobs”.\nMost Kubernetes objects are created using yaml. Here is a sample yaml for a job which uses perl to calculate pi to 2000 digits and then stops.\n1 2 3 4 5 6 7 8 9 10 11 12 13  apiVersion:batch/v1kind:Jobmetadata:name:pispec:template:spec:containers:- name:piimage:perlcommand:[\"perl\",\"-Mbignum=bpi\",\"-wle\",\"print bpi(2000)\"]restartPolicy:NeverbackoffLimit:4  Create this yaml file on your master node and call it “pi-job.yaml”. Run the job with the command:\n1  kubectl create -f pi-job.yaml   Get the detail information of this job with the command:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61  $ kubectl get pod NAME READY STATUS RESTARTS AGE ... pi-72c7r 0/1 Completed 0 3m $ kubectl describe pod pi-72c7r Name: pi-72c7r Namespace: default Node: juju-cfb27c-2/10.188.44.225 Start Time: Wed, 29 Aug 2018 02:45:34 +0000 Labels: controller-uid=9a903f30-ab35-11e8-9b51-feb3e5f3b327 job-name=pi Annotations:  Status: Succeeded IP: 10.1.33.7 Controlled By: Job/pi Containers: pi: Container ID: docker://0d48f71cc6a2825cf4113f237170e63b06e1e310eca2e950dc979b48f26fb41f Image: perl Image ID: docker-pullable://perl@sha256:a264b269d0ea9687ea1485e47a0f4039b2dab99fc9c6e3faf001b452b57d6087 Port:  Host Port:  Command: perl -Mbignum=bpi -wle print bpi(2000) State: Terminated Reason: Completed Exit Code: 0 Started: Wed, 29 Aug 2018 02:47:01 +0000 Finished: Wed, 29 Aug 2018 02:47:07 +0000 Ready: False Restart Count: 0 Environment:  Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-pkk4t (ro) Conditions: Type Status Initialized True Ready False ContainersReady False PodScheduled True Volumes: default-token-pkk4t: Type: Secret (a volume populated by a Secret) SecretName: default-token-pkk4t Optional: false QoS Class: BestEffort Node-Selectors:  Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 3m default-scheduler Successfully assigned default/pi-72c7r to juju-cfb27c-2 Normal Pulling 3m kubelet, juju-cfb27c-2 pulling image \"perl\" Normal Pulled 1m kubelet, juju-cfb27c-2 Successfully pulled image \"perl\" Normal Created 1m kubelet, juju-cfb27c-2 Created container Normal Started 1m kubelet, juju-cfb27c-2 Started container   And view the log(STDOUT) with below command:\n1 2  $ kubectl logs pi-72c7r 3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016534668049886272327917860857843838279679766814541009538837863609506800642251252051173929848960841284886269456042419652850222106611863067442786220391949450471237137869609563643719172874677646575739624138908658326459958133904780275898   Here is another example YAML file for job which use the image “busybox” and sleep for 10 seconds\n1 2 3 4 5 6 7 8 9 10 11 12 13  apiVersion:batch/v1kind:Jobmetadata:name:busyboxspec:template:spec:containers:- name:busyboximage:busyboxcommand:[\"sleep\",\"10\"]restartPolicy:NeverbackoffLimit:4  Deploy a Pod Pods usually represent running applications in a Kubernetes cluster. Here is an example of some yaml which defines a pod:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  apiVersion:v1kind:Podmetadata:name:alpinenamespace:defaultspec:containers:- name:alpineimage:alpinecommand:- sleep- \"3600\"imagePullPolicy:IfNotPresentrestartPolicy:Always  run a Pod 1  kubectl create -f alpine.yaml   delete a Pod 1  kubectl delete -f alpine.yaml   Or\n1  kubectl delete pod alpine   1  kubectl delete pod/alpine   Examine the current status 1 2 3  kubectl get nodes kubectl describe node node-name kubectl get pods --all-namespaces -o wide   Use -n will specify the namespace in use\n1  kubectl get pods -n kube-system   Deployment A yaml file for an nginx deployment\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  apiVersion: apps/v1beta2 kind: Deployment metadata: name: nginx-deployment spec: selector: matchLabels: app: nginx replicas: 2 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.7.9 ports: - containerPort: 80   Create the deployment and pod 1  kubectl create -f nginx-deployment.yaml   Find the detail info\n1  kubectl describe deployment nginx-deployment   Check pod is running on which node\n1 2 3  $ kubectl get pod nginx-deployment-7fc9b7bd96-c6wwh -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE nginx-deployment-7fc9b7bd96-c6wwh 1/1 Running 0 21h 10.1.33.6 juju-cfb27c-2    rollout image version Change the image version to 1.8, you run below command\n1  kubectl set image deployment nginx-deployment nginx=nginx:1.8   Or, you can update the line in the yaml to 1.8 version of the image, and apply the changes with\n1  kubectl apply -f nginx-deployment.yaml   Check the status of the rollout with below command\n1  kubectl rollout status deployment nginx-deployment   Undo the previous rollout\n1  kubectl rollout undo deployment nginx-deployment   View the history\n1  kubectl rollout history deployment nginx-deployment   Go to a specific point in history\n1  kubectl rollout history deployment nginx-deployment --revision=x   Setting Container Environment Variables Deploy a pod to print Environment Variables\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  apiVersion: v1 kind: Pod metadata: name: env-dump spec: containers: - name: busybox image: busybox command: - env env: - name: STUDENT_NAME value: \"Your Name\" - name: SCHOOL value: \"Linux Academy\" - name: KUBERNETES value: \"is awesome\"   After executed the pod, you can check Environment Viriables by log\n1 2 3 4 5 6  $ kubectl logs env-dump .... STUDENT_NAME=Your Name SCHOOL=Linux Academy KUBERNETES=is awesome ....   Scaling pod command line Use scale to deployment with –replicas=X\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  $ kubectl get deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 2 2 2 2 21h $ kubectl scale deployment nginx-deployment --replicas=3 deployment.extensions/nginx-deployment scaled $ kubectl get deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 3 3 3 3 21h $ kubectl get pod NAME READY STATUS RESTARTS AGE ... nginx-deployment-7fc9b7bd96-c6wwh 1/1 Running 0 21h nginx-deployment-7fc9b7bd96-kddj5 1/1 Running 0 31s nginx-deployment-7fc9b7bd96-s86gc 1/1 Running 0 21h   yaml file Update replicas: x part in yaml file, and apply the changes with\n1  kubectl apply -f nginx-deployment.yml   Replication Controllers, Replica Sets, and Deployments Deployments replaced the older ReplicationController functionality, but it never hurts to know where you came from. Deployments are easier to work with, and here’s a brief exercise to show you how. A Replication Controller ensures that a specified number of pod replicas are running at any one time. In other words, a Replication Controller makes sure that a pod or a homogeneous set of pods is always up and available.\nTo maintain three copies of an nginx container\nReplication Controllers 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  apiVersion: v1 kind: ReplicationController metadata: name: nginx spec: replicas: 3 selector: app: nginx template: metadata: name: nginx labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80   ReplicaSet 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  apiVersion: apps/v1beta2 kind: ReplicaSet metadata: name: nginx labels: app: nginx spec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80   Deployment 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  apiVersion: apps/v1beta2 # for versions before 1.8.0 use apps/v1beta1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx spec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80   Label Label node with colors\n1 2 3 4  kubectl label node node1-name color=black kubectl label node node2-name color=red kubectl label node node3-name color=green kubectl label node node4-name color=blue   Label all pod in default namespace by using --all\n1  kubectl label pods -n default color=white --all   Get pod/node/etc with specific label\n1  kubectl get pods -l color=white -n default   Get pod with multi labels\n1  kubectl get pods -l color=white,app=nginx   DaemonSet Deploy nginx pod on all node with\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  apiVersion: apps/v1 kind: DaemonSet metadata: name: cthulu labels: daemon: \"yup\" spec: selector: matchLabels: daemon: \"pod\" template: metadata: labels: daemon: pod spec: tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule containers: - name: cthulu-jr image: nginx   Confirm that pod is running on each node\n1 2 3 4 5  $ kubectl get pod -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE cthulu-kvbk9 1/1 Running 0 2m 10.1.33.8 juju-cfb27c-2  cthulu-t7hfc 1/1 Running 0 2m 10.1.45.13 juju-cfb27c-1  cthulu-x8hdf 1/1 Running 0 2m 10.1.31.9 juju-cfb27c-3    Label a Node \u0026 Schedule a Pod Label a Node to let you can schedule a pod on it.\n1  kubectl label node juju-cfb27c-3 deploy=here   use nodeSelector in yaml file to let a pod being deployed on the specific node\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  apiVersion: v1 kind: Pod metadata: name: busybox namespace: default spec: containers: - name: busybox image: busybox command: - sleep - \"300\" imagePullPolicy: IfNotPresent restartPolicy: Always nodeSelector: deploy: here   Confirm\n1 2 3  $ kubectl get pod busybox -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE busybox 1/1 Running 0 10s 10.1.31.10 juju-cfb27c-3    Specific Schedulers Ordinarily, we don’t need to specify the scheduler’s name in the spec because everyone uses a single default one. Sometimes, however, developers need to have custom schedulers in charge of placing pods due to legacy or specialized hardware constraints.\nUse schedulerName in yaml to specific a customer scheduler\n1 2 3 4 5 6 7 8 9 10 11 12 13  apiVersion: v1 kind: Pod metadata: name: annotation-default-scheduler labels: name: multischeduler annotations: scheduledBy: custom-scheduler spec: schedulerName: custom-scheduler containers: - name: pod-container image: k8s.gcr.io/pause:2.0   Logs View the current logs of a pod\n1  kubectl logs pod-name   View the current logs of a pod interactively\n1  kubectl logs pod-name -f   Print last 10 lines of the log.\n1  kubectl logs pod-name --tail=10   Log file in master/node machine can be found at /var/log/containers directory\nNode maintenance Maintenance a node by preventing the scheduler from putting new pods on to it and evicting any existing pods. Ignore the DaemonSets – those pods are only providing services to other local pods and will come back up when the node comes back up.\nIn this example I’m going to remove juju-cfb27c-2 from cluster.\n1 2 3  root@juju-cfb27c-0:~# kubectl drain juju-cfb27c-2 --ignore-daemonsets node/juju-cfb27c-2 cordoned WARNING: Ignoring DaemonSet-managed pods: cthulu-kvbk9, nginx-ingress-kubernetes-worker-controller-t6qh9   juju-cfb27c-2 is marked as “SchedulingDisabled”\n1 2 3 4 5  # kubectl get node NAME STATUS ROLES AGE VERSION juju-cfb27c-1 Ready  4d v1.11.2 juju-cfb27c-2 Ready,SchedulingDisabled  4d v1.11.2 juju-cfb27c-3 Ready  4d v1.11.2   Now -2 node can be shutdown and do maintenance work, no pod will be schedule on it. If you create some new pods, they will only placed on juju-cfb27c-1 and -3.\nNext, when -2 node is ready to use, you can get it back with\n1 2 3 4 5 6 7  # kubectl uncordon juju-cfb27c-2 node/juju-cfb27c-2 uncordoned # kubectl get node NAME STATUS ROLES AGE VERSION juju-cfb27c-1 Ready  4d v1.11.2 juju-cfb27c-2 Ready  4d v1.11.2 juju-cfb27c-3 Ready  4d v1.11.2   Upgrading Kubernetes Components Confirm the current version with\n1  kubectl get nodes    Upgrade kubeadm on the master node  1  sudo apt upgrade kubeadm   And confirm the version of kubeadm with\n1  kubeadm version    check the upgrade plan  1  sudo kubeadm upgrade plan    apply the upgrade plan  1  sudo kubeadm upgrade apply v1.x.x    upgrade kubelet  Before upgrade kubelet, first you need to drain the node which you want to upgrade\n1  kubectl drain NODENAME --ignore-daemonsets   Then, update kubelet manaully with\n1 2  sudo apt update sudo apt upgrade kubelet   Don’t forget to make your node avaliable after the upgrade.\n1  kubectl uncordon NODENAME   Network Inbound Node Port Requirements  Master Nodes  TCP 6443 – Kubernetes API Server TCP 2379-2380 – etcd server client API TCP 10250 – Kubelet API TCP 10251 – Kube-scheduler TCP 10252 – kube-controller-manager TCP 10255 – Read-only Kubelet API   Worker Nodes  TCP 10250 – Kubelet API TCP 10255 – Read-only Kubelet API TCP 30000-32767 – Node Port Services    export pod to the internet 1  # kubectl expost deployment NAME --type=\"NodePort\" --port XX   Deploying a Load Balancer 1 2 3 4 5 6 7 8 9 10 11 12 13 14  Kind:Service apiVersion: v1 metadata: name: la-lb-service spec: selector: app: la-lb ports: - protocol: TCP port: 80 targetPort:9376 clusterIP: 10.0.171.223 loadBalancerIP: 78.12.23.17 type: LoadBalancer   ","wordCount":"2512","inLanguage":"en","datePublished":"2018-08-29T11:40:56Z","dateModified":"2018-08-29T11:40:56Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wenhan.blog/post/certified-kubernetes-administrator-cka-learning-note/"},"publisher":{"@type":"Organization","name":"Wenhan blog","logo":{"@type":"ImageObject","url":"https://media.licdn.com/dms/image/C4D03AQHsFHxbDCgPsA/profile-displayphoto-shrink_400_400/0/1517015003915?e=1683763200\u0026v=beta\u0026t=PR0k2MbOHcJjtozRAQipgSz2CGprYxywDGgXInkOXmo"}}}</script>
</head><body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://wenhan.blog/ accesskey=h title="Home (Alt + H)">
<img src=https://wenhan.blog/apple-touch-icon.png alt aria-label=logo height=35>Home</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div></div><ul id=menu>
<li>
<a href=https://wenhan.blog/archives/ title=Archives>
<span>Archives</span>
</a>
</li><li>
<a href=https://wenhan.blog/tags/ title=Tags>
<span>Tags</span>
</a>
</li><li>
<a href=https://wenhan.blog/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li></ul></nav></header><main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://wenhan.blog/>Home</a>&nbsp;»&nbsp;<a href=https://wenhan.blog/post/>Posts</a></div><h1 class=post-title>
Certified Kubernetes Administrator (CKA) learning note
</h1><div class=post-meta><span title="2018-08-29 11:40:56 +0000 UTC">August 29, 2018</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2512 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/Certified-Kubernetes-Administrator-CKA-learning-note.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div></header><div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><nav id=TableOfContents>
<ul>
<li><a href=#run-a-pod>run a Pod</a></li><li><a href=#delete-a-pod>delete a Pod</a></li></ul><ul>
<li><a href=#create-the-deployment-and-pod>Create the deployment and pod</a></li><li><a href=#rollout-image-version>rollout image version</a></li></ul><ul>
<li><a href=#command-line>command line</a></li><li><a href=#yaml-file>yaml file</a></li></ul><ul>
<li><a href=#replication-controllers>Replication Controllers</a></li><li><a href=#replicaset>ReplicaSet</a></li><li><a href=#deployment-1>Deployment</a></li></ul><ul>
<li><a href=#inbound-node-port-requirements>Inbound Node Port Requirements</a></li><li><a href=#export-pod-to-the-internet>export pod to the internet</a></li><li><a href=#deploying-a-load-balancer>Deploying a Load Balancer</a></li></ul></nav></div></details>
</div><div class=post-content><h1 id=install>Install<a hidden class=anchor aria-hidden=true href=#install>#</a></h1><ol>
<li>Install docker.io</li></ol><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apt install docker.io
</span></span></code></pre></td></tr></table></div></div><p>If you install docker with other cgroup driver, you have to make sure that
docker and Kubernetes will use same cgroup driver.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cat &lt;&lt; EOF &gt;&gt; /etc/docker/daemon.json
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;]
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>EOF
</span></span></code></pre></td></tr></table></div></div><ol>
<li>install apt key and source to system</li></ol><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@kube-master:~# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl>root@kube-master:~# cat &lt;&lt;EOF &gt;&gt; /etc/apt/sources.list.d/kubernetes.list
</span></span><span class=line><span class=cl>&gt; deb http://apt.kubernetes.io/ kubernetes-xenial main
</span></span><span class=line><span class=cl>&gt; EOF
</span></span></code></pre></td></tr></table></div></div><p>Then install kubernetes packages</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@kube-master:~# apt update -y
</span></span><span class=line><span class=cl>root@kube-master:~# apt install -y kubelet kubeadm kubectl
</span></span></code></pre></td></tr></table></div></div><ol>
<li>setup and config with kubeadm</li></ol><p>You must choose a CNI when you execute <code>kubeadm init</code>, in this post I choose
flunnel, so I have to add <code>--pod-network-cidr</code> options.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@k8sm:~# kubeadm init --pod-network-cidr=10.244.0.0/16
</span></span></code></pre></td></tr></table></div></div><p>after waiting for some while, you should see below message that shows the
install is complete</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Your Kubernetes master has initialized successfully!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To start using your cluster, you need to run the following as a regular user:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  mkdir -p $HOME/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span class=line><span class=cl>  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You should now deploy a pod network to the cluster.
</span></span><span class=line><span class=cl>Run &#34;kubectl apply -f [podnetwork].yaml&#34; with one of the options listed at:
</span></span><span class=line><span class=cl>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can now join any number of machines by running the following on each node
</span></span><span class=line><span class=cl>as root:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  kubeadm join 192.168.122.75:6443 --token .....&lt;snip&gt;
</span></span></code></pre></td></tr></table></div></div><p>Follow the instruction, run below comand as a regular user</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  mkdir -p $HOME/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span class=line><span class=cl>  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</span></span></code></pre></td></tr></table></div></div><p>And you need to memo the command start with <code>kubeadm join</code>, you will need to
exeute this command on your kubernetes node to join to the cluster</p><p>In order for your pods to communicate with one another, you&rsquo;ll need to install
pod networking. We are going to use Flannel for our Container Network Interface
(CNI) because it&rsquo;s easy to install and reliable. Enter this command:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span></code></pre></td></tr></table></div></div><p>Next run below command to make sure everything is coming up.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get pods --all-namespaces
</span></span></code></pre></td></tr></table></div></div><p>If you see the coredns-xxxxxx pod is running, and your master node is Ready,
your cluster is ready to accept worker nodes.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wshi@k8sm:~$ kubectl get pods --all-namespaces
</span></span><span class=line><span class=cl>NAMESPACE     NAME                           READY     STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kube-system   coredns-78fcdf6894-ltgw2       1/1       Running   0          17m
</span></span><span class=line><span class=cl>kube-system   coredns-78fcdf6894-n8hw2       1/1       Running   0          17m
</span></span><span class=line><span class=cl>kube-system   etcd-k8sm                      1/1       Running   0          16m
</span></span><span class=line><span class=cl>kube-system   kube-apiserver-k8sm            1/1       Running   0          16m
</span></span><span class=line><span class=cl>kube-system   kube-controller-manager-k8sm   1/1       Running   0          16m
</span></span><span class=line><span class=cl>kube-system   kube-flannel-ds-amd64-ktcqm    1/1       Running   0          1m
</span></span><span class=line><span class=cl>kube-system   kube-proxy-nczhf               1/1       Running   0          17m
</span></span><span class=line><span class=cl>kube-system   kube-scheduler-k8sm            1/1       Running   0          16m
</span></span><span class=line><span class=cl>wshi@k8sm:~$ kubectl get node
</span></span><span class=line><span class=cl>NAME      STATUS    ROLES     AGE       VERSION
</span></span><span class=line><span class=cl>k8sm      Ready     master    17m       v1.11.2
</span></span></code></pre></td></tr></table></div></div><ol>
<li>setup other node and join to the cluster</li></ol><p>For the rest worker nodes, you just need to install kubectl, kubeadm, kubelet
and docker refer above, then execute the <code>kubeadm join ...</code> command which was
mentioned before.
After a while, you should see all worker nodes are ready to use.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wshi@k8sm:~$ kubectl get node
</span></span><span class=line><span class=cl>NAME      STATUS    ROLES     AGE       VERSION
</span></span><span class=line><span class=cl>k8sm      Ready     master    44m       v1.11.2
</span></span><span class=line><span class=cl>k8sn1     Ready     &lt;none&gt;    11m       v1.11.2
</span></span><span class=line><span class=cl>k8sn2     Ready     &lt;none&gt;    11m       v1.11.2
</span></span></code></pre></td></tr></table></div></div><h1 id=run-a-job>Run a Job<a hidden class=anchor aria-hidden=true href=#run-a-job>#</a></h1><p>Applications that running inside a pod are called &ldquo;jobs&rdquo;.</p><p>Most Kubernetes objects are created using yaml. Here is a sample yaml for a job which uses perl to calculate pi to 2000 digits and then stops.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>perl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;perl&#34;</span><span class=p>,</span><span class=w>  </span><span class=s2>&#34;-Mbignum=bpi&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-wle&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;print bpi(2000)&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backoffLimit</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Create this yaml file on your master node and call it &ldquo;pi-job.yaml&rdquo;. Run the job with the command:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f pi-job.yaml
</span></span></code></pre></td></tr></table></div></div><p>Get the detail information of this job with the command:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl get pod
</span></span><span class=line><span class=cl>NAME                                               READY     STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>pi-72c7r                                           0/1       Completed   0          3m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl describe pod pi-72c7r
</span></span><span class=line><span class=cl>Name:           pi-72c7r
</span></span><span class=line><span class=cl>Namespace:      default
</span></span><span class=line><span class=cl>Node:           juju-cfb27c-2/10.188.44.225
</span></span><span class=line><span class=cl>Start Time:     Wed, 29 Aug 2018 02:45:34 +0000
</span></span><span class=line><span class=cl>Labels:         controller-uid=9a903f30-ab35-11e8-9b51-feb3e5f3b327
</span></span><span class=line><span class=cl>                job-name=pi
</span></span><span class=line><span class=cl>Annotations:    &lt;none&gt;
</span></span><span class=line><span class=cl>Status:         Succeeded
</span></span><span class=line><span class=cl>IP:             10.1.33.7
</span></span><span class=line><span class=cl>Controlled By:  Job/pi
</span></span><span class=line><span class=cl>Containers:
</span></span><span class=line><span class=cl>  pi:
</span></span><span class=line><span class=cl>    Container ID:  docker://0d48f71cc6a2825cf4113f237170e63b06e1e310eca2e950dc979b48f26fb41f
</span></span><span class=line><span class=cl>    Image:         perl
</span></span><span class=line><span class=cl>    Image ID:      docker-pullable://perl@sha256:a264b269d0ea9687ea1485e47a0f4039b2dab99fc9c6e3faf001b452b57d6087
</span></span><span class=line><span class=cl>    Port:          &lt;none&gt;
</span></span><span class=line><span class=cl>    Host Port:     &lt;none&gt;
</span></span><span class=line><span class=cl>    Command:
</span></span><span class=line><span class=cl>      perl
</span></span><span class=line><span class=cl>      -Mbignum=bpi
</span></span><span class=line><span class=cl>      -wle
</span></span><span class=line><span class=cl>      print bpi(2000)
</span></span><span class=line><span class=cl>    State:          Terminated
</span></span><span class=line><span class=cl>      Reason:       Completed
</span></span><span class=line><span class=cl>      Exit Code:    0
</span></span><span class=line><span class=cl>      Started:      Wed, 29 Aug 2018 02:47:01 +0000
</span></span><span class=line><span class=cl>      Finished:     Wed, 29 Aug 2018 02:47:07 +0000
</span></span><span class=line><span class=cl>    Ready:          False
</span></span><span class=line><span class=cl>    Restart Count:  0
</span></span><span class=line><span class=cl>    Environment:    &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-pkk4t (ro)
</span></span><span class=line><span class=cl>Conditions:
</span></span><span class=line><span class=cl>  Type              Status
</span></span><span class=line><span class=cl>  Initialized       True 
</span></span><span class=line><span class=cl>  Ready             False 
</span></span><span class=line><span class=cl>  ContainersReady   False 
</span></span><span class=line><span class=cl>  PodScheduled      True 
</span></span><span class=line><span class=cl>Volumes:
</span></span><span class=line><span class=cl>  default-token-pkk4t:
</span></span><span class=line><span class=cl>    Type:        Secret (a volume populated by a Secret)
</span></span><span class=line><span class=cl>    SecretName:  default-token-pkk4t
</span></span><span class=line><span class=cl>    Optional:    false
</span></span><span class=line><span class=cl>QoS Class:       BestEffort
</span></span><span class=line><span class=cl>Node-Selectors:  &lt;none&gt;
</span></span><span class=line><span class=cl>Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
</span></span><span class=line><span class=cl>                 node.kubernetes.io/unreachable:NoExecute for 300s
</span></span><span class=line><span class=cl>Events:
</span></span><span class=line><span class=cl>  Type    Reason     Age   From                    Message
</span></span><span class=line><span class=cl>  ----    ------     ----  ----                    -------
</span></span><span class=line><span class=cl>  Normal  Scheduled  3m    default-scheduler       Successfully assigned default/pi-72c7r to juju-cfb27c-2
</span></span><span class=line><span class=cl>  Normal  Pulling    3m    kubelet, juju-cfb27c-2  pulling image &#34;perl&#34;
</span></span><span class=line><span class=cl>  Normal  Pulled     1m    kubelet, juju-cfb27c-2  Successfully pulled image &#34;perl&#34;
</span></span><span class=line><span class=cl>  Normal  Created    1m    kubelet, juju-cfb27c-2  Created container
</span></span><span class=line><span class=cl>  Normal  Started    1m    kubelet, juju-cfb27c-2  Started container
</span></span></code></pre></td></tr></table></div></div><p>And view the log(STDOUT) with below command:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl logs pi-72c7r
</span></span><span class=line><span class=cl>3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016534668049886272327917860857843838279679766814541009538837863609506800642251252051173929848960841284886269456042419652850222106611863067442786220391949450471237137869609563643719172874677646575739624138908658326459958133904780275898
</span></span></code></pre></td></tr></table></div></div><p>Here is another example YAML file for job which use the image &ldquo;busybox&rdquo; and sleep for 10 seconds</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sleep&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;10&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backoffLimit</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=deploy-a-pod>Deploy a Pod<a hidden class=anchor aria-hidden=true href=#deploy-a-pod>#</a></h1><p>Pods usually represent running applications in a Kubernetes cluster. Here is an example of some yaml which defines a pod:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>sleep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3600&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=run-a-pod>run a Pod<a hidden class=anchor aria-hidden=true href=#run-a-pod>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f alpine.yaml
</span></span></code></pre></td></tr></table></div></div><h2 id=delete-a-pod>delete a Pod<a hidden class=anchor aria-hidden=true href=#delete-a-pod>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete -f alpine.yaml
</span></span></code></pre></td></tr></table></div></div><p>Or</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl delete pod alpine
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl delete pod/alpine
</span></span></code></pre></td></tr></table></div></div><h1 id=examine-the-current-status>Examine the current status<a hidden class=anchor aria-hidden=true href=#examine-the-current-status>#</a></h1><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get nodes
</span></span><span class=line><span class=cl>kubectl describe node node-name
</span></span><span class=line><span class=cl>kubectl get pods --all-namespaces -o wide
</span></span></code></pre></td></tr></table></div></div><p>Use <code>-n</code> will specify the namespace in use</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get pods -n kube-system
</span></span></code></pre></td></tr></table></div></div><h1 id=deployment>Deployment<a hidden class=anchor aria-hidden=true href=#deployment>#</a></h1><p>A yaml file for an nginx deployment</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: apps/v1beta2
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nginx-deployment
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: nginx
</span></span><span class=line><span class=cl>  replicas: 2
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: nginx
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: nginx
</span></span><span class=line><span class=cl>        image: nginx:1.7.9
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 80
</span></span></code></pre></td></tr></table></div></div><h2 id=create-the-deployment-and-pod>Create the deployment and pod<a hidden class=anchor aria-hidden=true href=#create-the-deployment-and-pod>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl create -f nginx-deployment.yaml
</span></span></code></pre></td></tr></table></div></div><p>Find the detail info</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl describe deployment nginx-deployment
</span></span></code></pre></td></tr></table></div></div><p>Check pod is running on which node</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl get pod nginx-deployment-7fc9b7bd96-c6wwh -o wide
</span></span><span class=line><span class=cl>NAME                                READY     STATUS    RESTARTS   AGE       IP          NODE            NOMINATED NODE
</span></span><span class=line><span class=cl>nginx-deployment-7fc9b7bd96-c6wwh   1/1       Running   0          21h       10.1.33.6   juju-cfb27c-2   &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=rollout-image-version>rollout image version<a hidden class=anchor aria-hidden=true href=#rollout-image-version>#</a></h2><p>Change the image version to 1.8, you run below command</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl set image deployment nginx-deployment nginx=nginx:1.8
</span></span></code></pre></td></tr></table></div></div><p>Or, you can update the line in the yaml to 1.8 version of the image, and apply
the changes with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl apply -f nginx-deployment.yaml
</span></span></code></pre></td></tr></table></div></div><p>Check the status of the rollout with below command</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl rollout status deployment nginx-deployment
</span></span></code></pre></td></tr></table></div></div><p>Undo the previous rollout</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl rollout undo deployment nginx-deployment
</span></span></code></pre></td></tr></table></div></div><p>View the history</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl rollout history deployment nginx-deployment
</span></span></code></pre></td></tr></table></div></div><p>Go to a specific point in history</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl rollout history deployment nginx-deployment --revision=x
</span></span></code></pre></td></tr></table></div></div><h1 id=setting-container-environment-variables>Setting Container Environment Variables<a hidden class=anchor aria-hidden=true href=#setting-container-environment-variables>#</a></h1><p>Deploy a pod to print Environment Variables</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Pod
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: env-dump
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  containers:
</span></span><span class=line><span class=cl>  - name: busybox
</span></span><span class=line><span class=cl>    image: busybox
</span></span><span class=line><span class=cl>    command:
</span></span><span class=line><span class=cl>      - env
</span></span><span class=line><span class=cl>    env:
</span></span><span class=line><span class=cl>    - name: STUDENT_NAME
</span></span><span class=line><span class=cl>      value: &#34;Your Name&#34;
</span></span><span class=line><span class=cl>    - name: SCHOOL
</span></span><span class=line><span class=cl>      value: &#34;Linux Academy&#34;
</span></span><span class=line><span class=cl>    - name: KUBERNETES
</span></span><span class=line><span class=cl>      value: &#34;is awesome&#34;
</span></span></code></pre></td></tr></table></div></div><p>After executed the pod, you can check Environment Viriables by log</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl logs env-dump
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>STUDENT_NAME=Your Name
</span></span><span class=line><span class=cl>SCHOOL=Linux Academy
</span></span><span class=line><span class=cl>KUBERNETES=is awesome
</span></span><span class=line><span class=cl>....
</span></span></code></pre></td></tr></table></div></div><h1 id=scaling-pod>Scaling pod<a hidden class=anchor aria-hidden=true href=#scaling-pod>#</a></h1><h2 id=command-line>command line<a hidden class=anchor aria-hidden=true href=#command-line>#</a></h2><p>Use scale to deployment with &ndash;replicas=X</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl get deployment
</span></span><span class=line><span class=cl>NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx-deployment   2         2         2            2           21h
</span></span><span class=line><span class=cl>$ kubectl scale deployment nginx-deployment --replicas=3
</span></span><span class=line><span class=cl>deployment.extensions/nginx-deployment scaled
</span></span><span class=line><span class=cl>$ kubectl get deployment
</span></span><span class=line><span class=cl>NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx-deployment   3         3         3            3           21h
</span></span><span class=line><span class=cl>$ kubectl get pod
</span></span><span class=line><span class=cl>NAME                                               READY     STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>nginx-deployment-7fc9b7bd96-c6wwh                  1/1       Running     0          21h
</span></span><span class=line><span class=cl>nginx-deployment-7fc9b7bd96-kddj5                  1/1       Running     0          31s
</span></span><span class=line><span class=cl>nginx-deployment-7fc9b7bd96-s86gc                  1/1       Running     0          21h
</span></span></code></pre></td></tr></table></div></div><h2 id=yaml-file>yaml file<a hidden class=anchor aria-hidden=true href=#yaml-file>#</a></h2><p>Update <code>replicas: x</code> part in yaml file, and apply the changes with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl apply -f nginx-deployment.yml 
</span></span></code></pre></td></tr></table></div></div><h1 id=replication-controllers-replica-sets-and-deployments>Replication Controllers, Replica Sets, and Deployments<a hidden class=anchor aria-hidden=true href=#replication-controllers-replica-sets-and-deployments>#</a></h1><p>Deployments replaced the older ReplicationController functionality, but it never
hurts to know where you came from. Deployments are easier to work with,
and here&rsquo;s a brief exercise to show you how.
A Replication Controller ensures that a specified number of pod replicas are running
at any one time. In other words, a Replication Controller makes sure that a pod or
a homogeneous set of pods is always up and available.</p><p>To maintain three copies of an nginx container</p><h2 id=replication-controllers>Replication Controllers<a hidden class=anchor aria-hidden=true href=#replication-controllers>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: ReplicationController
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nginx
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 3
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    app: nginx
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      name: nginx
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: nginx
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: nginx
</span></span><span class=line><span class=cl>        image: nginx
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 80
</span></span></code></pre></td></tr></table></div></div><h2 id=replicaset>ReplicaSet<a hidden class=anchor aria-hidden=true href=#replicaset>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: apps/v1beta2
</span></span><span class=line><span class=cl>kind: ReplicaSet
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nginx
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: nginx
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 3
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: nginx
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: nginx
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: nginx
</span></span><span class=line><span class=cl>        image: nginx
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 80
</span></span></code></pre></td></tr></table></div></div><h2 id=deployment-1>Deployment<a hidden class=anchor aria-hidden=true href=#deployment-1>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: apps/v1beta2 # for versions before 1.8.0 use apps/v1beta1
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nginx-deployment
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: nginx
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 3
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: nginx
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: nginx
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: nginx
</span></span><span class=line><span class=cl>        image: nginx
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 80
</span></span></code></pre></td></tr></table></div></div><h1 id=label>Label<a hidden class=anchor aria-hidden=true href=#label>#</a></h1><p>Label node with colors</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl label node node1-name color=black
</span></span><span class=line><span class=cl>kubectl label node node2-name color=red
</span></span><span class=line><span class=cl>kubectl label node node3-name color=green
</span></span><span class=line><span class=cl>kubectl label node node4-name color=blue
</span></span></code></pre></td></tr></table></div></div><p>Label all pod in default namespace by using <code>--all</code></p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl label pods -n default color=white --all
</span></span></code></pre></td></tr></table></div></div><p>Get pod/node/etc with specific label</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get pods -l color=white -n default
</span></span></code></pre></td></tr></table></div></div><p>Get pod with multi labels</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get pods -l color=white,app=nginx
</span></span></code></pre></td></tr></table></div></div><h1 id=daemonset>DaemonSet<a hidden class=anchor aria-hidden=true href=#daemonset>#</a></h1><p>Deploy nginx pod on all node with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: apps/v1
</span></span><span class=line><span class=cl>kind: DaemonSet
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: cthulu
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    daemon: &#34;yup&#34;
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      daemon: &#34;pod&#34;
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        daemon: pod
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      tolerations:
</span></span><span class=line><span class=cl>      - key: node-role.kubernetes.io/master
</span></span><span class=line><span class=cl>        effect: NoSchedule
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: cthulu-jr
</span></span><span class=line><span class=cl>        image: nginx
</span></span></code></pre></td></tr></table></div></div><p>Confirm that pod is running on each node</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl get pod -o wide
</span></span><span class=line><span class=cl>NAME                                               READY     STATUS             RESTARTS   AGE       IP              NODE            NOMINATED NODE
</span></span><span class=line><span class=cl>cthulu-kvbk9                                       1/1       Running            0          2m        10.1.33.8       juju-cfb27c-2   &lt;none&gt;
</span></span><span class=line><span class=cl>cthulu-t7hfc                                       1/1       Running            0          2m        10.1.45.13      juju-cfb27c-1   &lt;none&gt;
</span></span><span class=line><span class=cl>cthulu-x8hdf                                       1/1       Running            0          2m        10.1.31.9       juju-cfb27c-3   &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><h1 id=label-a-node--schedule-a-pod>Label a Node & Schedule a Pod<a hidden class=anchor aria-hidden=true href=#label-a-node--schedule-a-pod>#</a></h1><p>Label a Node to let you can schedule a pod on it.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl label node juju-cfb27c-3 deploy=here
</span></span></code></pre></td></tr></table></div></div><p>use <code>nodeSelector</code> in yaml file to let a pod being deployed on the specific
node</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Pod
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: busybox
</span></span><span class=line><span class=cl>  namespace: default
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  containers:
</span></span><span class=line><span class=cl>  - name: busybox
</span></span><span class=line><span class=cl>    image: busybox
</span></span><span class=line><span class=cl>    command:
</span></span><span class=line><span class=cl>      - sleep
</span></span><span class=line><span class=cl>      - &#34;300&#34;
</span></span><span class=line><span class=cl>    imagePullPolicy: IfNotPresent
</span></span><span class=line><span class=cl>  restartPolicy: Always
</span></span><span class=line><span class=cl>  nodeSelector: 
</span></span><span class=line><span class=cl>    deploy: here 
</span></span></code></pre></td></tr></table></div></div><p>Confirm</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl get pod busybox -o wide
</span></span><span class=line><span class=cl>NAME      READY     STATUS    RESTARTS   AGE       IP           NODE            NOMINATED NODE
</span></span><span class=line><span class=cl>busybox   1/1       Running   0          10s       10.1.31.10   juju-cfb27c-3   &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><h1 id=specific-schedulers>Specific Schedulers<a hidden class=anchor aria-hidden=true href=#specific-schedulers>#</a></h1><p>Ordinarily, we don&rsquo;t need to specify the scheduler&rsquo;s name in the spec because everyone uses a
single default one. Sometimes, however, developers need to have custom schedulers in charge of
placing pods due to legacy or specialized hardware constraints.</p><p>Use <code>schedulerName</code> in yaml to specific a customer scheduler</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Pod
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: annotation-default-scheduler
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    name: multischeduler
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    scheduledBy: custom-scheduler
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  schedulerName: custom-scheduler
</span></span><span class=line><span class=cl>  containers:
</span></span><span class=line><span class=cl>  - name: pod-container
</span></span><span class=line><span class=cl>    image: k8s.gcr.io/pause:2.0
</span></span></code></pre></td></tr></table></div></div><h1 id=logs>Logs<a hidden class=anchor aria-hidden=true href=#logs>#</a></h1><p>View the current logs of a pod</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl logs pod-name
</span></span></code></pre></td></tr></table></div></div><p>View the current logs of a pod interactively</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl logs pod-name -f
</span></span></code></pre></td></tr></table></div></div><p>Print last 10 lines of the log.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl logs pod-name --tail=10
</span></span></code></pre></td></tr></table></div></div><p>Log file in master/node machine can be found at <code>/var/log/containers</code> directory</p><h1 id=node-maintenance>Node maintenance<a hidden class=anchor aria-hidden=true href=#node-maintenance>#</a></h1><p>Maintenance a node by preventing the scheduler from putting new pods on to it and
evicting any existing pods. Ignore the DaemonSets &ndash; those pods are only providing
services to other local pods and will come back up when the node comes back up.</p><p>In this example I&rsquo;m going to remove juju-cfb27c-2 from cluster.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@juju-cfb27c-0:~# kubectl drain juju-cfb27c-2 --ignore-daemonsets
</span></span><span class=line><span class=cl>node/juju-cfb27c-2 cordoned
</span></span><span class=line><span class=cl>WARNING: Ignoring DaemonSet-managed pods: cthulu-kvbk9, nginx-ingress-kubernetes-worker-controller-t6qh9
</span></span></code></pre></td></tr></table></div></div><p>juju-cfb27c-2 is marked as &ldquo;SchedulingDisabled&rdquo;</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># kubectl get node
</span></span><span class=line><span class=cl>NAME            STATUS                     ROLES     AGE       VERSION
</span></span><span class=line><span class=cl>juju-cfb27c-1   Ready                      &lt;none&gt;    4d        v1.11.2
</span></span><span class=line><span class=cl>juju-cfb27c-2   Ready,SchedulingDisabled   &lt;none&gt;    4d        v1.11.2
</span></span><span class=line><span class=cl>juju-cfb27c-3   Ready                      &lt;none&gt;    4d        v1.11.2
</span></span></code></pre></td></tr></table></div></div><p>Now -2 node can be shutdown and do maintenance work, no pod will be schedule on
it. If you create some new pods, they will only placed on juju-cfb27c-1 and -3.</p><p>Next, when -2 node is ready to use, you can get it back with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># kubectl uncordon juju-cfb27c-2 
</span></span><span class=line><span class=cl>node/juju-cfb27c-2 uncordoned
</span></span><span class=line><span class=cl># kubectl get node
</span></span><span class=line><span class=cl>NAME            STATUS    ROLES     AGE       VERSION
</span></span><span class=line><span class=cl>juju-cfb27c-1   Ready     &lt;none&gt;    4d        v1.11.2
</span></span><span class=line><span class=cl>juju-cfb27c-2   Ready     &lt;none&gt;    4d        v1.11.2
</span></span><span class=line><span class=cl>juju-cfb27c-3   Ready     &lt;none&gt;    4d        v1.11.2
</span></span></code></pre></td></tr></table></div></div><h1 id=upgrading-kubernetes-components>Upgrading Kubernetes Components<a hidden class=anchor aria-hidden=true href=#upgrading-kubernetes-components>#</a></h1><p>Confirm the current version with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get nodes
</span></span></code></pre></td></tr></table></div></div><ol>
<li>Upgrade kubeadm on the master node</li></ol><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt upgrade kubeadm
</span></span></code></pre></td></tr></table></div></div><p>And confirm the version of kubeadm with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubeadm version
</span></span></code></pre></td></tr></table></div></div><ol>
<li>check the upgrade plan</li></ol><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo kubeadm upgrade plan
</span></span></code></pre></td></tr></table></div></div><ol>
<li>apply the upgrade plan</li></ol><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo kubeadm upgrade apply v1.x.x
</span></span></code></pre></td></tr></table></div></div><ol>
<li>upgrade kubelet</li></ol><p>Before upgrade kubelet, first you need to drain the node which you want to
upgrade</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl drain NODENAME --ignore-daemonsets
</span></span></code></pre></td></tr></table></div></div><p>Then, update kubelet manaully with</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt upgrade kubelet
</span></span></code></pre></td></tr></table></div></div><p>Don&rsquo;t forget to make your node avaliable after the upgrade.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl uncordon NODENAME
</span></span></code></pre></td></tr></table></div></div><h1 id=network>Network<a hidden class=anchor aria-hidden=true href=#network>#</a></h1><h2 id=inbound-node-port-requirements>Inbound Node Port Requirements<a hidden class=anchor aria-hidden=true href=#inbound-node-port-requirements>#</a></h2><ul>
<li>Master Nodes
<ul>
<li>TCP 6443 &ndash; Kubernetes API Server</li><li>TCP 2379-2380 &ndash; etcd server client API</li><li>TCP 10250 &ndash; Kubelet API</li><li>TCP 10251 &ndash; Kube-scheduler</li><li>TCP 10252 &ndash; kube-controller-manager</li><li>TCP 10255 &ndash; Read-only Kubelet API</li></ul></li><li>Worker Nodes
<ul>
<li>TCP 10250 &ndash; Kubelet API</li><li>TCP 10255 &ndash; Read-only Kubelet API</li><li>TCP 30000-32767 &ndash; Node Port Services</li></ul></li></ul><h2 id=export-pod-to-the-internet>export pod to the internet<a hidden class=anchor aria-hidden=true href=#export-pod-to-the-internet>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># kubectl expost deployment NAME --type=&#34;NodePort&#34; --port XX
</span></span></code></pre></td></tr></table></div></div><h2 id=deploying-a-load-balancer>Deploying a Load Balancer<a hidden class=anchor aria-hidden=true href=#deploying-a-load-balancer>#</a></h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Kind:Service
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: la-lb-service
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    app: la-lb
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>  -  protocol: TCP
</span></span><span class=line><span class=cl>     port: 80
</span></span><span class=line><span class=cl>     targetPort:9376
</span></span><span class=line><span class=cl>  clusterIP: 10.0.171.223
</span></span><span class=line><span class=cl>  loadBalancerIP: 78.12.23.17
</span></span><span class=line><span class=cl>  type: LoadBalancer
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer>
<ul class=post-tags>
<li><a href=https://wenhan.blog/tags/kubernetes/>Kubernetes</a></li><li><a href=https://wenhan.blog/tags/cka/>CKA</a></li></ul><nav class=paginav>
<a class=prev href=https://wenhan.blog/post/openstack-frequently-used-command/>
<span class=title>« Prev</span>
<br>
<span>OpenStack frequently used command</span>
</a>
<a class=next href=https://wenhan.blog/post/juju-use-juju-to-deploy-minecraft-server-in-lxd/>
<span class=title>Next »</span>
<br>
<span>[Juju] Use juju to deploy minecraft server in LXD</span>
</a>
</nav><div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Certified Kubernetes Administrator (CKA) learning note on twitter" href="https://twitter.com/intent/tweet/?text=Certified%20Kubernetes%20Administrator%20%28CKA%29%20learning%20note&url=https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f&hashtags=Kubernetes%2cCKA"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Certified Kubernetes Administrator (CKA) learning note on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f&title=Certified%20Kubernetes%20Administrator%20%28CKA%29%20learning%20note&summary=Certified%20Kubernetes%20Administrator%20%28CKA%29%20learning%20note&source=https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Certified Kubernetes Administrator (CKA) learning note on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f&title=Certified%20Kubernetes%20Administrator%20%28CKA%29%20learning%20note"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Certified Kubernetes Administrator (CKA) learning note on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Certified Kubernetes Administrator (CKA) learning note on whatsapp" href="https://api.whatsapp.com/send?text=Certified%20Kubernetes%20Administrator%20%28CKA%29%20learning%20note%20-%20https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Certified Kubernetes Administrator (CKA) learning note on telegram" href="https://telegram.me/share/url?text=Certified%20Kubernetes%20Administrator%20%28CKA%29%20learning%20note&url=https%3a%2f%2fwenhan.blog%2fpost%2fcertified-kubernetes-administrator-cka-learning-note%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div></footer></article></main><footer class=footer>
<span>&copy; 2023 <a href=https://wenhan.blog/>Wenhan blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script>
<script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script>
</body></html>