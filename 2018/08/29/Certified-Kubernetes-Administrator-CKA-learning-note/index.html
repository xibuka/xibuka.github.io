<!doctype html>




<html class="theme-next pisces" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="R4LmYy1qpduVpsQoZvUXjxqKgmMw0vAgFCjS8UbQpSc" />













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Kubernetes,CKA," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Install Install docker.io  1apt install docker.io If you install docker with other cgroup driver, you have to make sure thatdocker and Kubernetes will use same cgroup driver. 12345cat &amp;lt;&amp;lt; EOF &amp;gt">
<meta name="keywords" content="Kubernetes,CKA">
<meta property="og:type" content="article">
<meta property="og:title" content="Certified Kubernetes Administrator (CKA) learning note">
<meta property="og:url" content="http://wenhan.blog/2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/index.html">
<meta property="og:site_name" content="Wenhan Code life">
<meta property="og:description" content="Install Install docker.io  1apt install docker.io If you install docker with other cgroup driver, you have to make sure thatdocker and Kubernetes will use same cgroup driver. 12345cat &amp;lt;&amp;lt; EOF &amp;gt">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-09-06T04:51:06.458Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Certified Kubernetes Administrator (CKA) learning note">
<meta name="twitter:description" content="Install Install docker.io  1apt install docker.io If you install docker with other cgroup driver, you have to make sure thatdocker and Kubernetes will use same cgroup driver. 12345cat &amp;lt;&amp;lt; EOF &amp;gt">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wenhan.blog/2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/"/>




<!-- ad start -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 自适应单元 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2422626403812806"
     data-ad-slot="1454707894"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- ad end -->


  <title> Certified Kubernetes Administrator (CKA) learning note | Wenhan Code life </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-87273435-2', 'auto');
  ga('send', 'pageview');
</script>











  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wenhan Code life</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Beware the dard side.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wenhan.blog/2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wenhan Shi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wenhan Code life">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Certified Kubernetes Administrator (CKA) learning note
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T11:40:56+09:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/" class="leancloud_visitors" data-flag-title="Certified Kubernetes Administrator (CKA) learning note">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><ol>
<li>Install docker.io</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install docker.io</span><br></pre></td></tr></table></figure>
<p>If you install docker with other cgroup driver, you have to make sure that<br>docker and Kubernetes will use same cgroup driver.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;&gt; /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol>
<li>install apt key and source to system</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kube-master:~# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">OK</span><br><span class="line">root@kube-master:~# cat &lt;&lt;EOF &gt;&gt; /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">&gt; deb http://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>
<p>Then install kubernetes packages</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kube-master:~# apt update -y</span><br><span class="line">root@kube-master:~# apt install -y kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>
<ol>
<li>setup and config with kubeadm</li>
</ol>
<a id="more"></a>
<p>You must choose a CNI when you execute <code>kubeadm init</code>, in this post I choose<br>flunnel, so I have to add <code>--pod-network-cidr</code> options.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@k8sm:~# kubeadm init --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>
<p>after waiting for some while, you should see below message that shows the<br>install is complete</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Your Kubernetes master has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">You can now join any number of machines by running the following on each node</span><br><span class="line">as root:</span><br><span class="line"></span><br><span class="line">  kubeadm join 192.168.122.75:6443 --token .....&lt;snip&gt;</span><br></pre></td></tr></table></figure>
<p>Follow the instruction, run below comand as a regular user</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>
<p>And you need to memo the command start with <code>kubeadm join</code>, you will need to<br>exeute this command on your kubernetes node to join to the cluster</p>
<p>In order for your pods to communicate with one another, you’ll need to install<br>pod networking.  We are going to use Flannel for our Container Network Interface<br>(CNI) because it’s easy to install and reliable.  Enter this command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>
<p>Next run below command to make sure everything is coming up.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure>
<p>If you see the coredns-xxxxxx pod is running, and your master node is Ready,<br>your cluster is ready to accept worker nodes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wshi@k8sm:~$ kubectl get pods --all-namespaces</span><br><span class="line">NAMESPACE     NAME                           READY     STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-78fcdf6894-ltgw2       1/1       Running   0          17m</span><br><span class="line">kube-system   coredns-78fcdf6894-n8hw2       1/1       Running   0          17m</span><br><span class="line">kube-system   etcd-k8sm                      1/1       Running   0          16m</span><br><span class="line">kube-system   kube-apiserver-k8sm            1/1       Running   0          16m</span><br><span class="line">kube-system   kube-controller-manager-k8sm   1/1       Running   0          16m</span><br><span class="line">kube-system   kube-flannel-ds-amd64-ktcqm    1/1       Running   0          1m</span><br><span class="line">kube-system   kube-proxy-nczhf               1/1       Running   0          17m</span><br><span class="line">kube-system   kube-scheduler-k8sm            1/1       Running   0          16m</span><br><span class="line">wshi@k8sm:~$ kubectl get node</span><br><span class="line">NAME      STATUS    ROLES     AGE       VERSION</span><br><span class="line">k8sm      Ready     master    17m       v1.11.2</span><br></pre></td></tr></table></figure>
<ol>
<li>setup other node and join to the cluster</li>
</ol>
<p>For the rest worker nodes, you just need to install kubectl, kubeadm, kubelet<br>and docker refer above, then execute the <code>kubeadm join ...</code> command which was<br>mentioned before.<br>After a while, you should see all worker nodes are ready to use.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wshi@k8sm:~$ kubectl get node</span><br><span class="line">NAME      STATUS    ROLES     AGE       VERSION</span><br><span class="line">k8sm      Ready     master    44m       v1.11.2</span><br><span class="line">k8sn1     Ready     &lt;none&gt;    11m       v1.11.2</span><br><span class="line">k8sn2     Ready     &lt;none&gt;    11m       v1.11.2</span><br></pre></td></tr></table></figure>
<h1 id="Run-a-Job"><a href="#Run-a-Job" class="headerlink" title="Run a Job"></a>Run a Job</h1><p>Applications that running inside a pod are called “jobs”.</p>
<p>Most Kubernetes objects are created using yaml. Here is a sample yaml for a job which uses perl to calculate pi to 2000 digits and then stops.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">pi</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">perl</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">["perl",</span>  <span class="string">"-Mbignum=bpi"</span><span class="string">,</span> <span class="string">"-wle"</span><span class="string">,</span> <span class="string">"print bpi(2000)"</span><span class="string">]</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Never</span></span><br><span class="line"><span class="attr">  backoffLimit:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>Create this yaml file on your master node and call it “pi-job.yaml”. Run the job with the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f pi-job.yaml</span><br></pre></td></tr></table></figure>
<p>Get the detail information of this job with the command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod</span><br><span class="line">NAME                                               READY     STATUS      RESTARTS   AGE</span><br><span class="line">...</span><br><span class="line">pi-72c7r                                           0/1       Completed   0          3m</span><br><span class="line"></span><br><span class="line">$ kubectl describe pod pi-72c7r</span><br><span class="line">Name:           pi-72c7r</span><br><span class="line">Namespace:      default</span><br><span class="line">Node:           juju-cfb27c-2/10.188.44.225</span><br><span class="line">Start Time:     Wed, 29 Aug 2018 02:45:34 +0000</span><br><span class="line">Labels:         controller-uid=9a903f30-ab35-11e8-9b51-feb3e5f3b327</span><br><span class="line">                job-name=pi</span><br><span class="line">Annotations:    &lt;none&gt;</span><br><span class="line">Status:         Succeeded</span><br><span class="line">IP:             10.1.33.7</span><br><span class="line">Controlled By:  Job/pi</span><br><span class="line">Containers:</span><br><span class="line">  pi:</span><br><span class="line">    Container ID:  docker://0d48f71cc6a2825cf4113f237170e63b06e1e310eca2e950dc979b48f26fb41f</span><br><span class="line">    Image:         perl</span><br><span class="line">    Image ID:      docker-pullable://perl@sha256:a264b269d0ea9687ea1485e47a0f4039b2dab99fc9c6e3faf001b452b57d6087</span><br><span class="line">    Port:          &lt;none&gt;</span><br><span class="line">    Host Port:     &lt;none&gt;</span><br><span class="line">    Command:</span><br><span class="line">      perl</span><br><span class="line">      -Mbignum=bpi</span><br><span class="line">      -wle</span><br><span class="line">      print bpi(2000)</span><br><span class="line">    State:          Terminated</span><br><span class="line">      Reason:       Completed</span><br><span class="line">      Exit Code:    0</span><br><span class="line">      Started:      Wed, 29 Aug 2018 02:47:01 +0000</span><br><span class="line">      Finished:     Wed, 29 Aug 2018 02:47:07 +0000</span><br><span class="line">    Ready:          False</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:    &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-pkk4t (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True </span><br><span class="line">  Ready             False </span><br><span class="line">  ContainersReady   False </span><br><span class="line">  PodScheduled      True </span><br><span class="line">Volumes:</span><br><span class="line">  default-token-pkk4t:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-pkk4t</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From                    Message</span><br><span class="line">  ----    ------     ----  ----                    -------</span><br><span class="line">  Normal  Scheduled  3m    default-scheduler       Successfully assigned default/pi-72c7r to juju-cfb27c-2</span><br><span class="line">  Normal  Pulling    3m    kubelet, juju-cfb27c-2  pulling image &quot;perl&quot;</span><br><span class="line">  Normal  Pulled     1m    kubelet, juju-cfb27c-2  Successfully pulled image &quot;perl&quot;</span><br><span class="line">  Normal  Created    1m    kubelet, juju-cfb27c-2  Created container</span><br><span class="line">  Normal  Started    1m    kubelet, juju-cfb27c-2  Started container</span><br></pre></td></tr></table></figure>
<p>And view the log(STDOUT) with below command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl logs pi-72c7r</span><br><span class="line">3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016534668049886272327917860857843838279679766814541009538837863609506800642251252051173929848960841284886269456042419652850222106611863067442786220391949450471237137869609563643719172874677646575739624138908658326459958133904780275898</span><br></pre></td></tr></table></figure>
<p>Here is another example YAML file for job which use the image “busybox” and sleep for 10 seconds</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">["sleep",</span> <span class="string">"10"</span><span class="string">]</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Never</span></span><br><span class="line"><span class="attr">  backoffLimit:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<h1 id="Deploy-a-Pod"><a href="#Deploy-a-Pod" class="headerlink" title="Deploy a Pod"></a>Deploy a Pod</h1><p>Pods usually represent running applications in a Kubernetes cluster.  Here is an example of some yaml which defines a pod:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">alpine</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">alpine</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">alpine</span></span><br><span class="line"><span class="attr">    command:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">sleep</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"3600"</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">  restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>
<h2 id="run-a-Pod"><a href="#run-a-Pod" class="headerlink" title="run a Pod"></a>run a Pod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f alpine.yaml</span><br></pre></td></tr></table></figure>
<h2 id="delete-a-Pod"><a href="#delete-a-Pod" class="headerlink" title="delete a Pod"></a>delete a Pod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f alpine.yaml</span><br></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod alpine</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod/alpine</span><br></pre></td></tr></table></figure>
<h1 id="Examine-the-current-status"><a href="#Examine-the-current-status" class="headerlink" title="Examine the current status"></a>Examine the current status</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br><span class="line">kubectl describe node node-name</span><br><span class="line">kubectl get pods --all-namespaces -o wide</span><br></pre></td></tr></table></figure>
<p>Use <code>-n</code> will specify the namespace in use</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>
<h1 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h1><p>A yaml file for an nginx deployment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1beta2</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.7.9</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<h2 id="Create-the-deployment-and-pod"><a href="#Create-the-deployment-and-pod" class="headerlink" title="Create the deployment and pod"></a>Create the deployment and pod</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f nginx-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>Find the detail info </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe deployment nginx-deployment</span><br></pre></td></tr></table></figure>
<p>Check pod is running on which node</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod nginx-deployment-7fc9b7bd96-c6wwh -o wide</span><br><span class="line">NAME                                READY     STATUS    RESTARTS   AGE       IP          NODE            NOMINATED NODE</span><br><span class="line">nginx-deployment-7fc9b7bd96-c6wwh   1/1       Running   0          21h       10.1.33.6   juju-cfb27c-2   &lt;none&gt;</span><br></pre></td></tr></table></figure>
<h2 id="rollout-image-version"><a href="#rollout-image-version" class="headerlink" title="rollout image version"></a>rollout image version</h2><p>Change the image version to 1.8, you run below command </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl set image deployment nginx-deployment nginx=nginx:1.8</span><br></pre></td></tr></table></figure>
<p>Or, you can update the line in the yaml to 1.8 version of the image, and apply<br>the changes with </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>Check the status of the rollout with below command </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout status deployment nginx-deployment</span><br></pre></td></tr></table></figure>
<p>Undo the previous rollout</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deployment nginx-deployment</span><br></pre></td></tr></table></figure>
<p>View the history </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout history deployment nginx-deployment</span><br></pre></td></tr></table></figure>
<p>Go to a specific point in history</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout history deployment nginx-deployment --revision=x</span><br></pre></td></tr></table></figure>
<h1 id="Setting-Container-Environment-Variables"><a href="#Setting-Container-Environment-Variables" class="headerlink" title="Setting Container Environment Variables"></a>Setting Container Environment Variables</h1><p>Deploy a pod to print Environment Variables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: env-dump</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox</span><br><span class="line">    image: busybox</span><br><span class="line">    command:</span><br><span class="line">      - env</span><br><span class="line">    env:</span><br><span class="line">    - name: STUDENT_NAME</span><br><span class="line">      value: &quot;Your Name&quot;</span><br><span class="line">    - name: SCHOOL</span><br><span class="line">      value: &quot;Linux Academy&quot;</span><br><span class="line">    - name: KUBERNETES</span><br><span class="line">      value: &quot;is awesome&quot;</span><br></pre></td></tr></table></figure>
<p>After executed the pod, you can check Environment Viriables by log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl logs env-dump</span><br><span class="line">....</span><br><span class="line">STUDENT_NAME=Your Name</span><br><span class="line">SCHOOL=Linux Academy</span><br><span class="line">KUBERNETES=is awesome</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<h1 id="Scaling-pod"><a href="#Scaling-pod" class="headerlink" title="Scaling pod"></a>Scaling pod</h1><h2 id="command-line"><a href="#command-line" class="headerlink" title="command line"></a>command line</h2><p>Use scale to deployment with –replicas=X</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get deployment</span><br><span class="line">NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deployment   2         2         2            2           21h</span><br><span class="line">$ kubectl scale deployment nginx-deployment --replicas=3</span><br><span class="line">deployment.extensions/nginx-deployment scaled</span><br><span class="line">$ kubectl get deployment</span><br><span class="line">NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deployment   3         3         3            3           21h</span><br><span class="line">$ kubectl get pod</span><br><span class="line">NAME                                               READY     STATUS      RESTARTS   AGE</span><br><span class="line">...</span><br><span class="line">nginx-deployment-7fc9b7bd96-c6wwh                  1/1       Running     0          21h</span><br><span class="line">nginx-deployment-7fc9b7bd96-kddj5                  1/1       Running     0          31s</span><br><span class="line">nginx-deployment-7fc9b7bd96-s86gc                  1/1       Running     0          21h</span><br></pre></td></tr></table></figure>
<h2 id="yaml-file"><a href="#yaml-file" class="headerlink" title="yaml file"></a>yaml file</h2><p>Update <code>replicas: x</code> part in yaml file, and apply the changes with </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx-deployment.yml</span><br></pre></td></tr></table></figure>
<h1 id="Replication-Controllers-Replica-Sets-and-Deployments"><a href="#Replication-Controllers-Replica-Sets-and-Deployments" class="headerlink" title="Replication Controllers, Replica Sets, and Deployments"></a>Replication Controllers, Replica Sets, and Deployments</h1><p>Deployments replaced the older ReplicationController functionality, but it never<br>hurts to know where you came from.  Deployments are easier to work with,<br>and here’s a brief exercise to show you how.<br>A Replication Controller ensures that a specified number of pod replicas are running<br>at any one time. In other words, a Replication Controller makes sure that a pod or<br>a homogeneous set of pods is always up and available.</p>
<p>To maintain three copies of an nginx container</p>
<h2 id="Replication-Controllers"><a href="#Replication-Controllers" class="headerlink" title="Replication Controllers"></a>Replication Controllers</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ReplicationController</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<h2 id="ReplicaSet"><a href="#ReplicaSet" class="headerlink" title="ReplicaSet"></a>ReplicaSet</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1beta2</span><br><span class="line">kind: ReplicaSet</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<h2 id="Deployment-1"><a href="#Deployment-1" class="headerlink" title="Deployment"></a>Deployment</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1beta2 # for versions before 1.8.0 use apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<h1 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h1><p>Label node with colors</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl label node node1-name color=black</span><br><span class="line">kubectl label node node2-name color=red</span><br><span class="line">kubectl label node node3-name color=green</span><br><span class="line">kubectl label node node4-name color=blue</span><br></pre></td></tr></table></figure>
<p>Label all pod in default namespace by using <code>--all</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl label pods -n default color=white --all</span><br></pre></td></tr></table></figure>
<p>Get pod/node/etc with specific label</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -l color=white -n default</span><br></pre></td></tr></table></figure>
<p>Get pod with multi labels</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -l color=white,app=nginx</span><br></pre></td></tr></table></figure>
<h1 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h1><p>Deploy nginx pod on all node with</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: DaemonSet</span><br><span class="line">metadata:</span><br><span class="line">  name: cthulu</span><br><span class="line">  labels:</span><br><span class="line">    daemon: &quot;yup&quot;</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      daemon: &quot;pod&quot;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        daemon: pod</span><br><span class="line">    spec:</span><br><span class="line">      tolerations:</span><br><span class="line">      - key: node-role.kubernetes.io/master</span><br><span class="line">        effect: NoSchedule</span><br><span class="line">      containers:</span><br><span class="line">      - name: cthulu-jr</span><br><span class="line">        image: nginx</span><br></pre></td></tr></table></figure>
<p>Confirm that pod is running on each node</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -o wide</span><br><span class="line">NAME                                               READY     STATUS             RESTARTS   AGE       IP              NODE            NOMINATED NODE</span><br><span class="line">cthulu-kvbk9                                       1/1       Running            0          2m        10.1.33.8       juju-cfb27c-2   &lt;none&gt;</span><br><span class="line">cthulu-t7hfc                                       1/1       Running            0          2m        10.1.45.13      juju-cfb27c-1   &lt;none&gt;</span><br><span class="line">cthulu-x8hdf                                       1/1       Running            0          2m        10.1.31.9       juju-cfb27c-3   &lt;none&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Label-a-Node-amp-Schedule-a-Pod"><a href="#Label-a-Node-amp-Schedule-a-Pod" class="headerlink" title="Label a Node &amp; Schedule a Pod"></a>Label a Node &amp; Schedule a Pod</h1><p>Label a Node to let you can schedule a pod on it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl label node juju-cfb27c-3 deploy=here</span><br></pre></td></tr></table></figure>
<p>use <code>nodeSelector</code> in yaml file to let a pod being deployed on the specific<br>node</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox</span><br><span class="line">    image: busybox</span><br><span class="line">    command:</span><br><span class="line">      - sleep</span><br><span class="line">      - &quot;300&quot;</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  restartPolicy: Always</span><br><span class="line">  nodeSelector: </span><br><span class="line">    deploy: here</span><br></pre></td></tr></table></figure>
<p>Confirm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod busybox -o wide</span><br><span class="line">NAME      READY     STATUS    RESTARTS   AGE       IP           NODE            NOMINATED NODE</span><br><span class="line">busybox   1/1       Running   0          10s       10.1.31.10   juju-cfb27c-3   &lt;none&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Specific-Schedulers"><a href="#Specific-Schedulers" class="headerlink" title="Specific Schedulers"></a>Specific Schedulers</h1><p>Ordinarily, we don’t need to specify the scheduler’s name in the spec because everyone uses a<br>single default one. Sometimes, however, developers need to have custom schedulers in charge of<br>placing pods due to legacy or specialized hardware constraints.</p>
<p>Use <code>schedulerName</code> in yaml to specific a customer scheduler</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: annotation-default-scheduler</span><br><span class="line">  labels:</span><br><span class="line">    name: multischeduler</span><br><span class="line">  annotations:</span><br><span class="line">    scheduledBy: custom-scheduler</span><br><span class="line">spec:</span><br><span class="line">  schedulerName: custom-scheduler</span><br><span class="line">  containers:</span><br><span class="line">  - name: pod-container</span><br><span class="line">    image: k8s.gcr.io/pause:2.0</span><br></pre></td></tr></table></figure>
<h1 id="Logs"><a href="#Logs" class="headerlink" title="Logs"></a>Logs</h1><p>View the current logs of a pod</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs pod-name</span><br></pre></td></tr></table></figure>
<p>View the current logs of a pod interactively</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs pod-name -f</span><br></pre></td></tr></table></figure>
<p>Print last 10 lines of the log.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs pod-name --tail=10</span><br></pre></td></tr></table></figure>
<p>Log file in master/node machine can be found at <code>/var/log/containers</code> directory</p>
<h1 id="Node-maintenance"><a href="#Node-maintenance" class="headerlink" title="Node maintenance"></a>Node maintenance</h1><p>Maintenance a node by preventing the scheduler from putting new pods on to it and<br>evicting any existing pods. Ignore the DaemonSets – those pods are only providing<br>services to other local pods and will come back up when the node comes back up.</p>
<p>In this example I’m going to remove juju-cfb27c-2 from cluster.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@juju-cfb27c-0:~# kubectl drain juju-cfb27c-2 --ignore-daemonsets</span><br><span class="line">node/juju-cfb27c-2 cordoned</span><br><span class="line">WARNING: Ignoring DaemonSet-managed pods: cthulu-kvbk9, nginx-ingress-kubernetes-worker-controller-t6qh9</span><br></pre></td></tr></table></figure>
<p>juju-cfb27c-2 is marked as “SchedulingDisabled”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># kubectl get node</span><br><span class="line">NAME            STATUS                     ROLES     AGE       VERSION</span><br><span class="line">juju-cfb27c-1   Ready                      &lt;none&gt;    4d        v1.11.2</span><br><span class="line">juju-cfb27c-2   Ready,SchedulingDisabled   &lt;none&gt;    4d        v1.11.2</span><br><span class="line">juju-cfb27c-3   Ready                      &lt;none&gt;    4d        v1.11.2</span><br></pre></td></tr></table></figure>
<p>Now -2 node can be shutdown and do maintenance work, no pod will be schedule on<br>it. If you create some new pods, they will only placed on juju-cfb27c-1 and -3.</p>
<p>Next, when -2 node is ready to use, you can get it back with </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># kubectl uncordon juju-cfb27c-2 </span><br><span class="line">node/juju-cfb27c-2 uncordoned</span><br><span class="line"># kubectl get node</span><br><span class="line">NAME            STATUS    ROLES     AGE       VERSION</span><br><span class="line">juju-cfb27c-1   Ready     &lt;none&gt;    4d        v1.11.2</span><br><span class="line">juju-cfb27c-2   Ready     &lt;none&gt;    4d        v1.11.2</span><br><span class="line">juju-cfb27c-3   Ready     &lt;none&gt;    4d        v1.11.2</span><br></pre></td></tr></table></figure>
<h1 id="Upgrading-Kubernetes-Components"><a href="#Upgrading-Kubernetes-Components" class="headerlink" title="Upgrading Kubernetes Components"></a>Upgrading Kubernetes Components</h1><p>Confirm the current version with</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>
<ol>
<li>Upgrade kubeadm on the master node</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt upgrade kubeadm</span><br></pre></td></tr></table></figure>
<p>And confirm the version of kubeadm with</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm version</span><br></pre></td></tr></table></figure>
<ol>
<li>check the upgrade plan</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm upgrade plan</span><br></pre></td></tr></table></figure>
<ol>
<li>apply the upgrade plan</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm upgrade apply v1.x.x</span><br></pre></td></tr></table></figure>
<ol>
<li>upgrade kubelet</li>
</ol>
<p>Before upgrade kubelet, first you need to drain the node which you want to<br>upgrade</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain NODENAME --ignore-daemonsets</span><br></pre></td></tr></table></figure>
<p>Then, update kubelet manaully with </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade kubelet</span><br></pre></td></tr></table></figure>
<p>Don’t forget to make your node avaliable after the upgrade.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl uncordon NODENAME</span><br></pre></td></tr></table></figure>
<h1 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h1><h2 id="Inbound-Node-Port-Requirements"><a href="#Inbound-Node-Port-Requirements" class="headerlink" title="Inbound Node Port Requirements"></a>Inbound Node Port Requirements</h2><ul>
<li>Master Nodes<ul>
<li>TCP 6443         –  Kubernetes API Server</li>
<li>TCP 2379-2380    –  etcd server client API</li>
<li>TCP 10250        –  Kubelet API</li>
<li>TCP 10251        –  Kube-scheduler</li>
<li>TCP 10252        –  kube-controller-manager</li>
<li>TCP 10255        –  Read-only Kubelet API</li>
</ul>
</li>
<li>Worker Nodes<ul>
<li>TCP 10250        –  Kubelet API</li>
<li>TCP 10255        –  Read-only Kubelet API</li>
<li>TCP 30000-32767  – Node Port Services</li>
</ul>
</li>
</ul>
<h2 id="export-pod-to-the-internet"><a href="#export-pod-to-the-internet" class="headerlink" title="export pod to the internet"></a>export pod to the internet</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># kubectl expost deployment NAME --type=&quot;NodePort&quot; --port XX</span><br></pre></td></tr></table></figure>
<h2 id="Deploying-a-Load-Balancer"><a href="#Deploying-a-Load-Balancer" class="headerlink" title="Deploying a Load Balancer"></a>Deploying a Load Balancer</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Kind:Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: la-lb-service</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: la-lb</span><br><span class="line">  ports:</span><br><span class="line">  -  protocol: TCP</span><br><span class="line">     port: 80</span><br><span class="line">     targetPort:9376</span><br><span class="line">  clusterIP: 10.0.171.223</span><br><span class="line">  loadBalancerIP: 78.12.23.17</span><br><span class="line">  type: LoadBalancer</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Kubernetes/" rel="tag"># Kubernetes</a>
          
            <a href="/tags/CKA/" rel="tag"># CKA</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/28/Juju-Use-juju-to-deploy-minecraft-server-in-LXD/" rel="next" title="[Juju] Use juju to deploy minecraft server in LXD">
                <i class="fa fa-chevron-left"></i> [Juju] Use juju to deploy minecraft server in LXD
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/27/OpenStack-frequently-used-command/" rel="prev" title="OpenStack frequently used command">
                OpenStack frequently used command <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/me.jpg"
               alt="Wenhan Shi" />
          <p class="site-author-name" itemprop="name">Wenhan Shi</p>
           
              <p class="site-description motion-element" itemprop="description">Ubuntu/RHEL Docker/k8s/OpenShift/GlusterFS</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xibuka" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/wenhan-shi-0883a9132/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/Shibunkan/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/xibuka" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Install"><span class="nav-number">1.</span> <span class="nav-text">Install</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Run-a-Job"><span class="nav-number">2.</span> <span class="nav-text">Run a Job</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Deploy-a-Pod"><span class="nav-number">3.</span> <span class="nav-text">Deploy a Pod</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#run-a-Pod"><span class="nav-number">3.1.</span> <span class="nav-text">run a Pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#delete-a-Pod"><span class="nav-number">3.2.</span> <span class="nav-text">delete a Pod</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Examine-the-current-status"><span class="nav-number">4.</span> <span class="nav-text">Examine the current status</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Deployment"><span class="nav-number">5.</span> <span class="nav-text">Deployment</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-the-deployment-and-pod"><span class="nav-number">5.1.</span> <span class="nav-text">Create the deployment and pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rollout-image-version"><span class="nav-number">5.2.</span> <span class="nav-text">rollout image version</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Setting-Container-Environment-Variables"><span class="nav-number">6.</span> <span class="nav-text">Setting Container Environment Variables</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Scaling-pod"><span class="nav-number">7.</span> <span class="nav-text">Scaling pod</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#command-line"><span class="nav-number">7.1.</span> <span class="nav-text">command line</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yaml-file"><span class="nav-number">7.2.</span> <span class="nav-text">yaml file</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Replication-Controllers-Replica-Sets-and-Deployments"><span class="nav-number">8.</span> <span class="nav-text">Replication Controllers, Replica Sets, and Deployments</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Replication-Controllers"><span class="nav-number">8.1.</span> <span class="nav-text">Replication Controllers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReplicaSet"><span class="nav-number">8.2.</span> <span class="nav-text">ReplicaSet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deployment-1"><span class="nav-number">8.3.</span> <span class="nav-text">Deployment</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Label"><span class="nav-number">9.</span> <span class="nav-text">Label</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DaemonSet"><span class="nav-number">10.</span> <span class="nav-text">DaemonSet</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Label-a-Node-amp-Schedule-a-Pod"><span class="nav-number">11.</span> <span class="nav-text">Label a Node &amp; Schedule a Pod</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Specific-Schedulers"><span class="nav-number">12.</span> <span class="nav-text">Specific Schedulers</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Logs"><span class="nav-number">13.</span> <span class="nav-text">Logs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Node-maintenance"><span class="nav-number">14.</span> <span class="nav-text">Node maintenance</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Upgrading-Kubernetes-Components"><span class="nav-number">15.</span> <span class="nav-text">Upgrading Kubernetes Components</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Network"><span class="nav-number">16.</span> <span class="nav-text">Network</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Inbound-Node-Port-Requirements"><span class="nav-number">16.1.</span> <span class="nav-text">Inbound Node Port Requirements</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#export-pod-to-the-internet"><span class="nav-number">16.2.</span> <span class="nav-text">export pod to the internet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deploying-a-Load-Balancer"><span class="nav-number">16.3.</span> <span class="nav-text">Deploying a Load Balancer</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>

  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <!-- ad start -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 自适应单元 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2422626403812806"
     data-ad-slot="1454707894"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- ad end -->

<div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wenhan Shi</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://xibuka.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://wenhan.blog/2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/';
          this.page.identifier = '2018/08/29/Certified-Kubernetes-Administrator-CKA-learning-note/';
          this.page.title = 'Certified Kubernetes Administrator (CKA) learning note';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://xibuka.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  













  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("90wEGXD7uoUqTufkP5rUni2y-gzGzoHsz", "4vhv6NPtEfNUWFOd4v5ktPSk");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
